---
layout: post
title: Obsidian æ¶ˆè´¹è®°è´¦ç»ˆææŒ‡å—ï¼šä»ä¸€é”®å½•å…¥åˆ°è‡ªåŠ¨åŒ–ä»ªè¡¨ç›˜
date: 2025-09-20
categories:
  - Obsidian
tags:
  - Obsidian
  - Dataview
  - Templater
  - ä¸ªäººç†è´¢
draft: true
---
æˆ‘èŠ±äº†å¤§é‡æ—¶é—´æ¢ç´¢å’Œè¿­ä»£ï¼Œæœ€ç»ˆåœ¨ Obsidian ä¸­æ­å»ºäº†ä¸€å¥—**ä¸ªäººæ¶ˆè´¹è¿½è¸ªç³»ç»Ÿ**ã€‚

ç°åœ¨ï¼Œæˆ‘å°†æ¯«æ— ä¿ç•™åœ°åˆ†äº«ç»™ä½ ã€‚åªéœ€è·Ÿç€æŒ‡å—æ“ä½œï¼Œä½ å°±èƒ½æ‹¥æœ‰ä¸€ä¸ª**â€œä¸€é”®å½•å…¥ã€è‡ªåŠ¨åˆå¹¶ã€æ™ºèƒ½æ’åºâ€**çš„å½•å…¥æ¨¡æ¿ï¼Œä»¥åŠä¸€ä¸ª**â€œå¤šç»´åº¦ã€å¯äº¤äº’â€**çš„å…¨åŠŸèƒ½æ¶ˆè´¹ä»ªè¡¨ç›˜ã€‚

ä¸ºä»€ä¹ˆæ˜¯ Obsidianï¼Ÿå› ä¸ºå®ƒå°†æ•°æ®æ‰€æœ‰æƒ 100% äº¤è¿˜ç»™ä½ ï¼ŒåŒæ—¶é€šè¿‡å¼ºå¤§çš„æ’ä»¶ç”Ÿæ€ï¼Œè®©ä½ çš„æœ¬åœ°ç¬”è®°åº“åŒ–èº«ä¸ºæ— æ‰€ä¸èƒ½çš„ä¸ªäººæ•°æ®ä¸­å¿ƒã€‚

## æœ€ç»ˆæ•ˆæœé¢„è§ˆï¼ˆæ•ˆæœå›¾åœ¨åº•éƒ¨ï¼‰

æƒ³è±¡ä¸€ä¸‹ä½ ç†æƒ³ä¸­çš„è®°è´¦æµç¨‹ï¼š
1.  **ä¸€é”®å¿«é€Ÿå½•å…¥**ï¼šæ— è®ºä½•æ—¶ä½•åœ°æ¶ˆè´¹ï¼Œåªéœ€æŒ‰ä¸‹å¿«æ·é”®ï¼Œè¾“å…¥é‡‘é¢ï¼ˆç”šè‡³æ”¯æŒ `30+15` è¿™æ ·çš„å¿«æ·è®¡ç®—ï¼‰ï¼Œé€‰æ‹©åˆ†ç±»ï¼Œå³å¯å®Œæˆè®°å½•ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸è¶…è¿‡10ç§’ã€‚
2.  **å…¨åŠŸèƒ½æ¶ˆè´¹ä»ªè¡¨ç›˜**ï¼šåœ¨ä¸€ä¸ªä¸“å±é¡µé¢ï¼Œä½ å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°ï¼š
    *   **æœˆåº¦/å¹´åº¦å¯åˆ‡æ¢è§†å›¾**ï¼šè½»æ¾å›é¡¾ä¸Šä¸ªæœˆæˆ–å»å¹´çš„æ¶ˆè´¹çŠ¶å†µã€‚
    *   **åŠ¨æ€å›¾è¡¨**ï¼šæ¶ˆè´¹åˆ†ç±»ç™¾åˆ†æ¯”ã€æœˆåº¦æ¶ˆè´¹è¶‹åŠ¿æŠ˜çº¿å›¾ï¼Œä¸€ç›®äº†ç„¶ã€‚
    *   **æ·±åº¦æ•°æ®æ´å¯Ÿ**ï¼šè‡ªåŠ¨è®¡ç®—æœˆå‡æ¶ˆè´¹ã€æ¶ˆè´¹æœ€é«˜æœˆä»½ã€æ”¯å‡ºå† å†›ç±»åˆ«ç­‰å…³é”®æŒ‡æ ‡ã€‚

è¿™å¥—ç³»ç»Ÿä¸ä»…ä¸ºä½ çœæ—¶ï¼Œæ›´èƒ½å°†æ¯ç‡¥çš„æ•°æ®è½¬åŒ–ä¸ºå¸®ä½ ä¼˜åŒ–æ¶ˆè´¹ã€å®ç°ç†è´¢ç›®æ ‡çš„å¼ºå¤§åŠ¨åŠ›ã€‚

> æç¤ºï¼šæ‚¨å¯ä»¥åˆ©ç”¨ iOS çš„å¿«æ·æŒ‡ä»¤ï¼ˆShortcutsï¼‰ç»“åˆ Obsidian çš„ **Advanced URI** æ’ä»¶ï¼Œä¸€é”®è°ƒç”¨è®°è´¦æ¨¡æ¿ï¼Œå¿«é€Ÿå®Œæˆè®°è´¦ã€‚å¦‚æœæ‚¨å¯¹ Advanced URI çš„ç”¨æ³•ä¸ç†Ÿæ‚‰ï¼Œå¯ä»¥åœ¨å„å¤§å¹³å°æœç´¢ç›¸å…³æ•™ç¨‹ï¼Œæˆ–å‚è€ƒæ­¤[è§†é¢‘](https://www.bilibili.com/video/BV1fv411N7Pt/?spm_id_from=333.337.search-card.all.click&vd_source=2ace218823368be28bbfaeb34a2ff39d)ã€‚ï¼ˆè¯·æ³¨æ„ï¼šè¯¥è§†é¢‘éæœ¬äººåˆ¶ä½œï¼Œä»…ä½œç¤ºä¾‹ï¼‰ã€‚

## æ‰€éœ€å·¥å…·

- [Obsidian](https://obsidian.md/)ï¼ˆå…è´¹ä¸‹è½½è‡ªå®˜ç½‘ï¼‰ã€‚
- **æ’ä»¶**ï¼ˆåœ¨Obsidianè®¾ç½® > ç¤¾åŒºæ’ä»¶ä¸­å®‰è£…å¹¶å¯ç”¨ï¼‰ï¼š
  - **Templater**ï¼šè‡ªåŠ¨åŒ–è„šæœ¬çš„æ ¸å¿ƒï¼Œè´Ÿè´£å¤„ç†æ‰€æœ‰çš„æ•°æ®å½•å…¥å’Œæ–‡ä»¶ä¿®æ”¹é€»è¾‘ã€‚
  - **Dataview**ï¼šæ•°æ®æŸ¥è¯¢ä¸å¯è§†åŒ–ã€‚
  - **Charts**ï¼šå›¾è¡¨ç»˜åˆ¶ã€‚
  - **Advanced URI**ï¼šå¯é€‰ã€‚

è¯·ç¡®ä¿å®‰è£…å¹¶å¯ç”¨ä¸Šè¿°æ’ä»¶åï¼Œé‡å¯ Obsidianã€‚

---
## Part 1: æ„å»ºæ•°æ®æ ¸å¿ƒ (The Core Data System)

æˆ‘ä»¬çš„ç³»ç»Ÿç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼šä¸€ä¸ªæ™ºèƒ½å½•å…¥æ¨¡æ¿ï¼Œä¸€ä¸ªçº¯æ–‡æœ¬æ—¥å¿—æ–‡ä»¶ï¼Œä»¥åŠä¸€ä¸ªæ•°æ®ä»ªè¡¨ç›˜ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ¥åˆ›å»ºå‰ä¸¤ä¸ªã€‚

### 1.1 æ™ºèƒ½å½•å…¥æ¨¡æ¿ (æ¶ˆè´¹è®°å½•.md)

åœ¨ä½ çš„ Templater æ¨¡æ¿æ–‡ä»¶å¤¹ä¸­ï¼ˆä¾‹å¦‚ "Templates"ï¼‰ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `è®°è´¦.md` çš„æ–‡ä»¶ï¼Œå¹¶ç²˜è´´ä»¥ä¸‹**å®Œæ•´ä»£ç **ã€‚è¿™æ˜¯æ•´ä¸ªç³»ç»Ÿçš„â€œå†™å…¥å¤§è„‘â€ã€‚

<details>
<summary style="color: #4CAF50; font-weight: bold; cursor: pointer;">âš™ï¸ ç‚¹å‡»æŸ¥çœ‹/æŠ˜å â€œæ™ºèƒ½æ¶ˆè´¹å½•å…¥è„šæœ¬â€ä»£ç </summary>

```javascript
<%*
// --- âš™ï¸ é…ç½®åŒº ---
const filePath = "è®°å½•/æ¶ˆè´¹/æ¶ˆè´¹-log.md";
const dateFormat = "YY-MM-DD";
const expenseCategories = ["é¤é¥®", "äº¤é€š", "è´­ç‰©", "å¨±ä¹", "å­¦ä¹ ", "ç”Ÿæ´»æ‚è´¹", "åŒ»ç–—å¥åº·"];
const incomeCategories = ["å·¥èµ„", "å¥–é‡‘", "å…¼èŒ", "æŠ•èµ„å›æŠ¥"]; // æ–°å¢æ”¶å…¥åˆ†ç±»
// --- ç»“æŸé…ç½® ---

// --- æ ¸å¿ƒå‡½æ•°åŒº ---
function safeCalculate(expression) {
    try {
        const sanitized = String(expression).trim();
        if (!/^[0-9\.\+\-\s\*\/\(\)]+$/.test(sanitized)) return NaN;
        return new Function('return ' + sanitized)();
    } catch (error) {
        return NaN;
    }
}

// æ™ºèƒ½é‡‘é¢è§£æï¼ˆæ”¯æŒæ­£è´Ÿå·ï¼‰
async function promptForValidAmount(promptMessage, placeholder = "") {
    let amountInput = await tp.system.prompt(promptMessage, placeholder, true);
    if (!amountInput) return null;
    
    // ç¬¦å·æ™ºèƒ½å¤„ç†
    const hasExplicitSign = /^[+-]/.test(amountInput);
    let amount = safeCalculate(amountInput);
    
    // æœªæ˜ç¡®ç¬¦å·æ—¶ï¼šæ­£æ•°è§†ä¸ºæ”¯å‡ºï¼ˆè´Ÿï¼‰ï¼Œè´Ÿæ•°è§†ä¸ºæ”¶å…¥ï¼ˆæ­£ï¼‰
    if (!hasExplicitSign && !isNaN(amount)) {
        amount = amount > 0 ? -amount : Math.abs(amount);
    }
    
    while (isNaN(amount) || amount === 0) {
        const msg = isNaN(amount) 
            ? "âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—é‡‘é¢" 
            : "âŒ é‡‘é¢ä¸èƒ½ä¸ºé›¶";
        new Notice(msg, 4000);
        amountInput = await tp.system.prompt(promptMessage, placeholder, true);
        if (!amountInput) return null;
        amount = safeCalculate(amountInput);
        
        if (!hasExplicitSign && !isNaN(amount)) {
            amount = amount > 0 ? -amount : Math.abs(amount);
        }
    }
    return amount;
}

// åŠ¨æ€åˆ†ç±»é€‰æ‹©ï¼ˆæ ¹æ®é‡‘é¢æ­£è´Ÿï¼‰
async function getCategoryAndRemark(amount) {
    const isIncome = amount > 0;
    const categories = isIncome ? incomeCategories : expenseCategories;
    const amountType = isIncome ? "æ”¶å…¥" : "æ”¯å‡º";
    
    const category = await tp.system.suggester(
        categories, 
        categories, 
        false, 
        `Â¥${Math.abs(amount)} ${amountType}é€‰æ‹©ç±»åˆ«`
    );
    if (!category) return null;
    
    const remark = await tp.system.prompt("å¤‡æ³¨ (å¯é€‰)", "", false) || "";
    return { category, remark };
}

// --- ä¸»é€»è¾‘å¼€å§‹ ---
let transactions = [];
let targetDateString = tp.date.now(dateFormat);
const nowTimeString = tp.date.now("HH:mm"); // å½“å‰æ—¶é—´

const modeInput = await tp.system.prompt("ğŸ’° è¾“å…¥é‡‘é¢ (m â–¸ å¤šæ¡, b â–¸ è¡¥å½•)", "", true);
if (!modeInput) return;

const mode = modeInput.trim().toLowerCase();

// --- æ¨¡å¼ä¸€ï¼šé—ªç”µè®°è´¦ (m) ---
if (mode === 'm') {
    new Notice("âš¡ï¸ å·²è¿›å…¥é—ªç”µæ¨¡å¼", 2000);
    let entryCount = 1;
    while (true) {
        const amount = await promptForValidAmount(`ç¬¬ ${entryCount} ç¬”: é‡‘é¢ (ç•™ç©ºå®Œæˆ)`);
        if (amount === null) break;

        const details = await getCategoryAndRemark(amount);
        if (!details) continue;

        // æ¯æ¡è®°å½•è·å–å®æ—¶æ—¶é—´
        const entryTime = tp.date.now("HH:mm");
        transactions.push({
            ...details,
            amount,
            date: tp.date.now(dateFormat),
            time: entryTime
        });
        new Notice(`ğŸ‘ å·²æ·»åŠ ç¬¬ ${entryCount} ç¬”`, 2000);
        entryCount++;
    }
}
// --- æ¨¡å¼äºŒï¼šè¡¥å½•æ—§è´¦ (b) ---
else if (mode === 'b') {
    const recentDays = [
        { text: `ä»Šå¤© (${tp.date.now(dateFormat)})`, value: tp.date.now(dateFormat) },
        { text: `æ˜¨å¤© (${tp.date.now(dateFormat, -1)})`, value: tp.date.now(dateFormat, -1) }
    ];
    for (let i = 2; i <= 7; i++) { 
        recentDays.push({ text: `${i}å¤©å‰ (${tp.date.now(dateFormat, -i)})`, value: tp.date.now(dateFormat, -i) });
    }
    recentDays.push({ text: "æ‰‹åŠ¨æŒ‡å®šæ—¥æœŸ...", value: "manual" });
    
    const selectedDateOption = await tp.system.suggester(
        recentDays.map(d => d.text), 
        recentDays.map(d => d.value), 
        false, 
        "è¯·é€‰æ‹©è¡¥å½•æ—¥æœŸ"
    );
    if (!selectedDateOption) return;
    
    if (selectedDateOption === 'manual') {
        const manualDate = await tp.system.prompt(`è¯·è¾“å…¥æ—¥æœŸ (æ ¼å¼: ${dateFormat})`, tp.date.now(dateFormat));
        if (!manualDate || !/^\d{2}-\d{2}-\d{2}$/.test(manualDate.trim())) { 
            new Notice("âŒ æ—¥æœŸæ ¼å¼é”™è¯¯", 4000); 
            return; 
        }
        targetDateString = manualDate.trim();
    } else {
        targetDateString = selectedDateOption;
    }
    
    const amount = await promptForValidAmount(`ä¸º [${targetDateString}] è¾“å…¥é‡‘é¢`);
    if (amount !== null) {
        const details = await getCategoryAndRemark(amount);
        if (details) {
            transactions.push({
                ...details,
                amount,
                date: targetDateString,
                time: nowTimeString
            });
        }
    }
}
// --- æ¨¡å¼ä¸‰ï¼šå¿«é€Ÿå•æ¡ (é»˜è®¤) ---
else {
    let amount = safeCalculate(modeInput);
    if (isNaN(amount) || amount === 0) {
        amount = await promptForValidAmount(`âŒ "${modeInput}" ä¸æ˜¯æœ‰æ•ˆæŒ‡ä»¤ï¼Œè¯·é‡æ–°è¾“å…¥é‡‘é¢`);
    }
    
    if (amount !== null) {
        // ç¬¦å·æ™ºèƒ½å¤„ç†ï¼ˆæ— ç¬¦å·æ—¶æ­£æ•°è½¬è´Ÿï¼‰
        if (!/^[+-]/.test(modeInput) && amount > 0) amount = -amount;
        
        const details = await getCategoryAndRemark(amount);
        if (details) {
            transactions.push({
                ...details,
                amount,
                date: targetDateString,
                time: nowTimeString
            });
        }
    }
}

// --- æ–‡ä»¶å¤„ç† (å…¨æ–°é€»è¾‘) ---
if (transactions.length === 0) {
    new Notice("æ“ä½œå·²å–æ¶ˆ", 2000);
    return;
}

const file = tp.file.find_tfile(filePath);
if (!file) { 
    new Notice(`âŒ æ‰¾ä¸åˆ°æ–‡ä»¶: "${filePath}"`, 5000); 
    return; 
}

// è¯»å–ç°æœ‰å†…å®¹
let content = await app.vault.read(file);
let existingLines = content.split('\n').filter(line => 
    line.trim() && line.startsWith('- [')
);

// è½¬æ¢æ–°äº¤æ˜“è®°å½•ä¸ºæ–‡æœ¬è¡Œ
const newLines = transactions.map(trans => {
    const sign = trans.amount > 0 ? '+' : '';
    return `- [${trans.date}][${trans.category}:${trans.remark}|${sign}${trans.amount}][${trans.time}]`;
});

// åˆå¹¶æ–°æ—§è®°å½•å¹¶æ’åºï¼ˆæœ€æ–°åœ¨æœ€å‰ï¼‰
const allLines = [...existingLines, ...newLines];
allLines.sort((a, b) => {
    // æå–æ—¥æœŸå’Œæ—¶é—´
    const extractDT = line => {
        const [_, date, time] = line.match(/\[(\d{2}-\d{2}-\d{2})\].*?\[(\d{2}:\d{2})\]/);
        return { date, time };
    };
    const dtA = extractDT(a);
    const dtB = extractDT(b);
    
    // å…ˆæŒ‰æ—¥æœŸå€’åºï¼ŒåŒæ—¥æœŸæŒ‰æ—¶é—´å€’åº
    return dtB.date.localeCompare(dtA.date) || dtB.time.localeCompare(dtA.time);
});

// å†™å…¥æ–‡ä»¶
await app.vault.modify(file, allLines.join('\n'));
new Notice(`âœ… ${transactions.length}ç¬”äº¤æ˜“å·²è®°å½•`, 3000);
%>
```

</details>

### 1.2 æ¶ˆè´¹æ—¥å¿—æ–‡ä»¶ (æ¶ˆè´¹-log.md)

è¿™æ˜¯ä½ çš„â€œæ•°æ®åº“â€ã€‚åœ¨ä½ å¸Œæœ›å­˜æ”¾æ—¥å¿—çš„ä½ç½®ï¼ˆä¾‹å¦‚ `è®°å½•/æ¶ˆè´¹/` æ–‡ä»¶å¤¹ä¸‹ï¼‰ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `æ¶ˆè´¹-log.md` çš„æ–‡ä»¶ã€‚

> [!IMPORTANT] å…³é”®ä¸€è‡´æ€§åŸåˆ™
> è¯·ç¡®ä¿**æ™ºèƒ½å½•å…¥è„šæœ¬**å’Œ**æ¶ˆè´¹ä»ªè¡¨ç›˜**ï¼ˆè§Part 3ï¼‰é¡¶éƒ¨çš„ `filePath` è·¯å¾„ï¼Œä¸ä½ è¿™ä¸ªæ—¥å¿—æ–‡ä»¶çš„**çœŸå®è·¯å¾„å’Œæ–‡ä»¶å**å®Œå…¨ä¸€è‡´ï¼è¿™æ˜¯æ•´ä¸ªç³»ç»Ÿèƒ½ååŒå·¥ä½œçš„åŸºçŸ³ã€‚

---
## Part 2: é…ç½®â€œä¸€é”®å½•å…¥â€å‘½ä»¤

è®©é­”æ³•å‘ç”Ÿå¾—æ›´ç®€å•ã€‚

1.  **è®¾ç½® Templater æ¨¡æ¿æ–‡ä»¶å¤¹**ï¼š
    *   æ‰“å¼€ Obsidian è®¾ç½® > ç¤¾åŒºæ’ä»¶ > Templaterã€‚
    *   åœ¨â€œTemplate folder locationâ€ä¸­æŒ‡å®šä½ çš„æ¨¡æ¿æ–‡ä»¶å¤¹è·¯å¾„ï¼ˆå¦‚ `Templates`ï¼‰ã€‚

2.  **ç»‘å®šå¿«æ·é”®**ï¼š
    *   åœ¨ Templater è®¾ç½®ä¸­ï¼Œæ‰¾åˆ°â€œTemplate Hotkeysâ€éƒ¨åˆ†ã€‚
    *   ç‚¹å‡»â€œAdd new for templateâ€ï¼Œé€‰æ‹©æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ `è®°è´¦.md` æ¨¡æ¿ã€‚
    *   **ä¸ºå®ƒåˆ†é…ä¸€ä¸ªä½ é¡ºæ‰‹çš„å¿«æ·é”®**ï¼ˆä¾‹å¦‚ `âŒ¥+m`ï¼‰ï¼Œå®ç°çœŸæ­£çš„ä¸€é”®è§¦å‘ã€‚

ç°åœ¨ï¼Œè¯•è¯•æŒ‰ä¸‹ä½ çš„å¿«æ·é”®ï¼Œä½“éªŒä¸æ»‘çš„å½•å…¥æµç¨‹å§ï¼

---
## Part 3: æ‰“é€ ä½ çš„ä¸“å±â€œæ¶ˆè´¹ä»ªè¡¨ç›˜â€

æœ€åä¸€æ­¥ï¼Œè®©æ²‰ç¡çš„æ•°æ®â€œå¼€å£è¯´è¯â€ã€‚åœ¨ä½ å¸Œæœ›å±•ç¤ºä»ªè¡¨ç›˜çš„ä»»ä½•åœ°æ–¹ï¼ˆä¾‹å¦‚ä½ çš„ä¸»é¡µ `Homepage.md`ï¼‰ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç¬”è®°ï¼ˆä¾‹å¦‚ `æ¶ˆè´¹ä»ªè¡¨ç›˜.md`ï¼‰ï¼Œå¹¶ç²˜è´´ä»¥ä¸‹**å®Œæ•´ä»£ç **ã€‚

<details>
<summary style="color: #FF6384; font-weight: bold; cursor: pointer;">ğŸ“Š ç‚¹å‡»æŸ¥çœ‹/æŠ˜å â€œæ¶ˆè´¹ä»ªè¡¨ç›˜â€ä»£ç </summary>

````markdown
```dataviewjs
// ======================================================================
//             Obsidian æ¶ˆè´¹ä»ªè¡¨ç›˜ - v1.0
// ======================================================================
// ä½œè€…: [Seitx's Blog](https://setix.xyz/)
// ç‰ˆæœ¬: 1.0
// æè¿°: ä¸€æ¬¾æ³¨å…¥äº†â€œå°‘å³æ˜¯å¤šâ€è®¾è®¡å“²å­¦ã€æ— ç¼äº¤äº’ä½“éªŒä¸å•†ä¸šçº§å¥å£®æ€§çš„æ™ºèƒ½è´¢åŠ¡é¡¾é—®ã€‚
// ======================================================================

const CONFIG = {
    // --- æ ¸å¿ƒé…ç½® ---
    filePath: "è®°å½•/æ¶ˆè´¹/æ¶ˆè´¹-log.md", // [å¿…å¡«] ä¿®æ”¹ä¸ºæ‚¨è®°è´¦æ—¥å¿—æ–‡ä»¶çš„å®Œæ•´è·¯å¾„
    currencySymbol: "Â¥",              // [å¯é€‰] è´§å¸ç¬¦å·, å¯æ”¹ä¸º "$" "â‚¬" ç­‰
    
    // --- åˆ†ç±»é…ç½® (å¯æŒ‰éœ€å¢åˆ ) ---
    expenseCategories: [
        "é¤é¥®", "å­¦ä¹ ", "äº¤é€š", "è´­ç‰©", "å¨±ä¹", 
        "ç”Ÿæ´»æ‚è´¹", "åŒ»ç–—å¥åº·", "æœªåˆ†ç±»"
    ],
    incomeCategories: [
        "å·¥èµ„", "å¥–é‡‘", "å…¼èŒ", "æŠ•èµ„å›æŠ¥"
    ],

    // --- å¤–è§‚é…ç½® (è¯·ä¸ä¸Šé¢çš„åˆ†ç±»åä¿æŒä¸€è‡´) ---
    categoryColors: {
        "é¤é¥®": "#A78BFA",
        "å­¦ä¹ ": "#5EEAD4",
        "äº¤é€š": "#FDE047", 
        "è´­ç‰©": "#F472B6",
        "å¨±ä¹": "#60A5FA",
        "ç”Ÿæ´»æ‚è´¹": "#FDBA74",
        "åŒ»ç–—å¥åº·": "#BDBDBD",
        "å·¥èµ„": "#34D399",
        "å¥–é‡‘": "#A3E635",
        "å…¼èŒ": "#FBBF24",
        "æŠ•èµ„å›æŠ¥": "#60A5FA",
        "æœªåˆ†ç±»": "#E5E7EB"
    }
};


// --- å·¥å…·å‡½æ•° ---
function formatMoney(number) { return parseFloat(number.toFixed(2)); }
function highlightText(text, query) {
    if (!query || typeof text !== 'string') return text;
    const escapedQuery = query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    const regex = new RegExp(escapedQuery, 'gi');
    return text.replace(regex, (match) => `<span class="search-highlight">${match}</span>`);
}

class FinanceDashboard {
	
    constructor(container, config) {
        this.container = container;
        this.config = config;
        this.app = window.app;
        this.dv = dv;
        this.state = {
            allTransactions: null, monthOffset: 0, yearOffset: 0, activeView: 'monthly',
            searchQuery: '', searchSort: 'time_desc', showIncome: false, openModalInfo: null,
            currentViewTransactions: [],
        };
        this.elements = {
            navContainer: null, monthlyContainer: null, annualContainer: null, searchContainer: null,
            listContainer: null, analysisContainer: null,
        };
        this.modalCleanupStack = [];
    }
    
	async init() {
	    this.container.innerHTML = '';
	    try {
	        this.state.allTransactions = await this.parseTransactionData();
	        if (this.state.allTransactions === null) {
	            this.renderError("âŒ **é”™è¯¯ï¼š** æ— æ³•åŠ è½½æˆ–è§£ææ¶ˆè´¹æ—¥å¿—æ–‡ä»¶ã€‚è¯·æ£€æŸ¥ `filePath` é…ç½®æ˜¯å¦æ­£ç¡®ã€‚");
	            return;
	        }
	        this.addGlobalStyles();
	        this.renderLayout();
	        this.switchView(this.state.activeView);
	        this._setupGlobalKeyListener(); 
	    } catch (error) {
	        console.error("ä»ªè¡¨ç›˜åˆå§‹åŒ–å¤±è´¥:", error);
	        this.renderError(`âŒ **è„šæœ¬å‘ç”Ÿä¸¥é‡é”™è¯¯ï¼š** ${error.message}`);
	    }
	}

	_setupGlobalKeyListener() {
	    document.addEventListener('keydown', (event) => {
	        if (event.key === 'Escape' && this.modalCleanupStack.length > 0) {
	            event.preventDefault(); 
	            const cleanupLastModal = this.modalCleanupStack.pop(); 
	            if (cleanupLastModal) {
	                cleanupLastModal();
	            }
	        }
	    });
	}

    _calculateGrowth(current, previous, metricType = 'income') {
        if (previous === 0) {
            return { text: current > 0 ? `+${this.config.currencySymbol}${formatMoney(current)}` : '-', class: 'neutral' };
        }
        const percentage = ((current - previous) / previous) * 100;
        if (Math.abs(percentage) < 0.1) {
            return { text: 'â†’ 0.0%', class: 'neutral' };
        }
        
        const sign = percentage > 0 ? '+' : '';
        let colorClass = percentage > 0 ? 'positive' : 'negative';
        if (metricType === 'expense') {
            colorClass = percentage > 0 ? 'negative' : 'positive';
        }

        return {
            text: `${sign}${percentage.toFixed(1)}%`,
            class: colorClass
        };
    }

    _updateDynamicContent() {
        if (this.state.activeView === 'monthly') {
            this._updateMonthlyDynamicContent();
        } else if (this.state.activeView === 'annual') {
            this._updateAnnualDynamicContent();
        }
    }
	
    renderError(message) {
        this.container.innerHTML = `<div style="padding: 20px; background-color: var(--background-secondary, #2a2a2a); border-radius: 8px;">${message}</div>`;
    }

    renderLayout() {
        this.elements.navContainer = this.container.createEl('div', { attr: { style: 'display: flex; gap: 8px; margin-bottom: 20px;' } });
        this.createNavButton('æœˆåº¦è§†å›¾', 'monthly');
        this.createNavButton('å¹´åº¦è§†å›¾', 'annual');
        this.createNavButton('å…¨å±€æœç´¢', 'search');
        const cardStyleClass = 'content-card';
        this.elements.monthlyContainer = this.container.createEl('div', { cls: cardStyleClass });
        this.elements.annualContainer = this.container.createEl('div', { cls: cardStyleClass });
        this.elements.searchContainer = this.container.createEl('div', { cls: cardStyleClass });
    }

    createNavButton(text, viewName) {
        const button = this.elements.navContainer.createEl('button', { text: text, attr: { 'data-view': viewName, class: 'main-nav-button' } });
        button.onclick = () => {
            if (this.state.activeView !== viewName) {
                this.state.monthOffset = 0;
                this.state.yearOffset = 0;
            }
            this.switchView(viewName);
        };
    }

    switchView(view) {
        this.state.activeView = view;
        const { monthlyContainer, annualContainer, searchContainer, navContainer } = this.elements;
        monthlyContainer.style.display = view === 'monthly' ? 'block' : 'none';
        annualContainer.style.display = view === 'annual' ? 'block' : 'none';
        searchContainer.style.display = view === 'search' ? 'block' : 'none';
        navContainer.querySelectorAll('.main-nav-button').forEach(btn => btn.classList.toggle('active', btn.getAttribute('data-view') === view));
        
        switch (view) {
            case 'monthly': this.renderMonthlyView(); break;
            case 'annual': this.renderAnnualView(); break;
            case 'search': this.renderSearchView(); break;
        }
    }
    
	renderMonthlyView() {
	    const container = this.elements.monthlyContainer;
	    container.innerHTML = '';
	    const targetMonth = this.dv.luxon.DateTime.now().plus({ months: this.state.monthOffset });
	    
	    const nav = container.createEl('div', { attr: { style: 'display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;' } });
	    const monthSelector = nav.createEl('div', { text: targetMonth.toFormat("yyyyå¹´MMæœˆ"), cls: 'control-button' });
	    monthSelector.onclick = () => this.showMonthPicker(targetMonth);
	    
        const navButton = nav.createEl('button', { cls: 'control-button secondary' });
        if (this.state.monthOffset === 0) {
            navButton.setText('ä¸Šä¸ªæœˆ');
            navButton.onclick = () => { this.state.monthOffset--; this.renderMonthlyView(); };
        } else {
            navButton.setText('è¿”å›æœ¬æœˆ');
            navButton.onclick = () => { this.state.monthOffset = 0; this.renderMonthlyView(); };
        }

	    this.state.currentViewTransactions = this.state.allTransactions.filter(t => t.date.hasSame(targetMonth, 'month'));
        const prevMonthTransactions = this.state.allTransactions.filter(t => t.date.hasSame(targetMonth.minus({ months: 1 }), 'month'));
	
	    if (this.state.currentViewTransactions.length === 0) {
	        container.createEl("p", { text: `âœ… åœ¨ ${targetMonth.toFormat("yyyyå¹´MMæœˆ")} æ²¡æœ‰æ‰¾åˆ°æ¶ˆè´¹è®°å½•ã€‚` });
	        return;
	    }
	    
	    const processedData = this.state.currentViewTransactions.reduce((acc, t) => {
	        if (t.isIncome) { acc.incomes.push(t); acc.totalIncome += t.amount; } 
            else { acc.expenses.push(t); acc.totalExpense += t.amount; }
	        return acc;
	    }, { expenses: [], incomes: [], totalExpense: 0, totalIncome: 0 });
	
	    const currentTotalExpense = Math.abs(processedData.totalExpense);
	    const currentTotalIncome = processedData.totalIncome;
        const prevMonthTotalExpense = Math.abs(prevMonthTransactions.filter(t => !t.isIncome).reduce((sum, t) => sum + t.amount, 0));
        const prevMonthTotalIncome = prevMonthTransactions.filter(t => t.isIncome).reduce((sum, t) => sum + t.amount, 0);
	    
	    const summaryContainer = container.createEl('div', { cls: 'summary-container' });
        const expenseCell = summaryContainer.createEl('div');
        expenseCell.innerHTML = `<div class="summary-label">æœ¬æœˆæ”¯å‡º</div><div class="summary-value">${this.config.currencySymbol}${formatMoney(currentTotalExpense)}</div>`;
        if (prevMonthTransactions.length > 0) {
            const growth = this._calculateGrowth(currentTotalExpense, prevMonthTotalExpense, 'expense');
            expenseCell.createEl('div', { text: `ç¯æ¯” ${growth.text}`, cls: `growth-indicator ${growth.class}` });
        }
        
        const incomeCell = summaryContainer.createEl('div');
        incomeCell.innerHTML = `<div class="summary-label">æœ¬æœˆæ”¶å…¥</div><div class="summary-value income">${this.config.currencySymbol}${formatMoney(currentTotalIncome)}</div>`;
        if (prevMonthTransactions.length > 0) {
            const growth = this._calculateGrowth(currentTotalIncome, prevMonthTotalIncome, 'income');
            incomeCell.createEl('div', { text: `ç¯æ¯” ${growth.text}`, cls: `growth-indicator ${growth.class}` });
        }
	
        const weeksInMonth = Math.ceil(targetMonth.endOf('month').day / 7);
        const weeklyData = Array.from({ length: weeksInMonth }, () => ({ expense: 0, income: 0 }));

        this.state.currentViewTransactions.forEach(t => {
            const weekIndex = Math.floor((t.date.day - 1) / 7);
            if (weeklyData[weekIndex]) {
                t.isIncome ? weeklyData[weekIndex].income += t.amount : weeklyData[weekIndex].expense += Math.abs(t.amount);
            }
        });

	    const weeklyLabels = weeklyData.map((_, index) => `ç¬¬ ${index + 1} å‘¨`);
	    const weeklyExpenses = weeklyData.map(w => w.expense);
	    const weeklyIncomes = weeklyData.map(w => w.income);

	    const chartContainerId = `monthly-trend-chart-${Date.now()}`;
	    container.createEl('div', { attr: { id: chartContainerId, style: 'width: 100%; height: 280px; margin: 10px auto;' } });
	    this.renderTrendChart(chartContainerId, weeklyLabels, weeklyExpenses, weeklyIncomes);
	    this.renderToggleSwitch(container, 'monthly');
	    
        this.elements.listContainer = container.createEl('div');
	    this._updateMonthlyDynamicContent();
	
	    container.createEl('hr', { cls: 'divider' });
	    container.createEl('h3', {text: "æœ¬æœˆæ˜ç»†", cls: 'section-title'});
	    const detailsCard = container.createEl('div', { cls: 'details-card' });
	    this.state.currentViewTransactions.sort((a, b) => b.date.toMillis() - a.date.toMillis() || b.time.localeCompare(a.time));
	    this.renderTransactionList(detailsCard.createEl('div'), this.state.currentViewTransactions);
	}

    _updateMonthlyDynamicContent() {
        this.elements.listContainer.innerHTML = '';
        const transactions = this.state.currentViewTransactions;
        const expenses = transactions.filter(t => !t.isIncome);
        const incomes = transactions.filter(t => t.isIncome);
        const totalExpense = expenses.reduce((sum, t) => sum + Math.abs(t.amount), 0);
        const totalIncome = incomes.reduce((sum, t) => sum + t.amount, 0);
        this.state.showIncome ? this.renderCategoryList(this.elements.listContainer, incomes, totalIncome) : this.renderCategoryList(this.elements.listContainer, expenses, totalExpense);
    }
		
	renderAnnualView() {
	    const container = this.elements.annualContainer;
	    container.innerHTML = '';
	    const targetYear = this.dv.luxon.DateTime.now().plus({ years: this.state.yearOffset });

	    const nav = container.createEl('div', { attr: { style: 'display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;' } });
	    const yearSelector = nav.createEl('div', { text: targetYear.toFormat("yyyyå¹´"), cls: 'control-button' });
	    yearSelector.onclick = () => this.showYearPicker(targetYear);

        const navButton = nav.createEl('button', { cls: 'control-button secondary' });
        if (this.state.yearOffset === 0) {
            navButton.setText('ä¸Šä¸€å¹´');
            navButton.onclick = () => { this.state.yearOffset--; this.renderAnnualView(); };
        } else {
            navButton.setText('è¿”å›æœ¬å¹´');
            navButton.onclick = () => { this.state.yearOffset = 0; this.renderAnnualView(); };
        }
        
	    this.state.currentViewTransactions = this.state.allTransactions.filter(t => t.date.hasSame(targetYear, 'year'));
	    if (this.state.currentViewTransactions.length === 0) {
	        container.createEl("p", { text: `âœ… åœ¨ ${targetYear.toFormat("yyyy'å¹´'")} æ²¡æœ‰æ‰¾åˆ°æ¶ˆè´¹è®°å½•ã€‚` });
	        return;
	    }
	    
	    const monthlyExpenses = Array(12).fill(0);
	    const monthlyIncomes = Array(12).fill(0);
	    this.state.currentViewTransactions.forEach(t => { 
            if (t.isIncome) {
                monthlyIncomes[t.date.month-1] += t.amount;
            } else {
                monthlyExpenses[t.date.month-1] += Math.abs(t.amount);
            }
        });
	    
	    this.renderAnnualSummary(container, monthlyExpenses, monthlyIncomes, targetYear);
	    const chartContainerId = `annual-trend-chart-${Date.now()}`;
	    container.createEl('div', { attr: { id: chartContainerId, style: 'width: 100%; height: 280px; margin: 10px auto;' } });
	    const monthLabels = ['1','2','3','4','5','6','7','8','9','10','11','12'];
	    this.renderTrendChart(chartContainerId, monthLabels, monthlyExpenses, monthlyIncomes);
	    this.renderToggleSwitch(container, 'annual');

        this.elements.listContainer = container.createEl('div');
        container.createEl('hr', { cls: 'divider' });
        container.createEl('h3', { text: 'æ‚¨çš„å¹´åº¦æ•…äº‹æ¿', cls: 'section-title analysis-section-title' });
        this.elements.analysisContainer = container.createEl('div', { cls: 'annual-analysis-container' });

        this._updateAnnualDynamicContent();
	}

    _updateAnnualDynamicContent() {
        this.elements.listContainer.innerHTML = '';
        this.elements.analysisContainer.innerHTML = '';

        const transactions = this.state.currentViewTransactions;
        const expenses = transactions.filter(t => !t.isIncome);
        const incomes = transactions.filter(t => t.isIncome);
        const totalExpenseForList = expenses.reduce((sum, t) => sum + Math.abs(t.amount), 0);
        const totalIncomeForList = incomes.reduce((sum, t) => sum + t.amount, 0);

        if (this.state.showIncome) {
            this.renderCategoryList(this.elements.listContainer, incomes, totalIncomeForList);
            this.renderIncomeAnalysis(this.elements.analysisContainer, transactions);
        } else {
            this.renderCategoryList(this.elements.listContainer, expenses, totalExpenseForList);
            this.renderSpendingAnalysis(this.elements.analysisContainer, transactions);
        }
    }

    renderSpendingAnalysis(container, transactions) {
        const expenses = transactions.filter(t => !t.isIncome);
        if (expenses.length < 1) {
            container.createEl('p', { text: 'æœ¬å¹´åº¦æ— æ”¯å‡ºè®°å½•ï¼Œæ— æ³•ç”Ÿæˆåˆ†ææŠ¥å‘Šã€‚', attr: { style: 'text-align: center; color: var(--text-muted);' }});
            return;
        }

        const categoryData = {};
        const timeSlotData = {
            "å‡Œæ™¨ (0-5ç‚¹)": { total: 0, count: 0 }, "æ¸…æ™¨ (5-9ç‚¹)": { total: 0, count: 0 },
            "ä¸Šåˆ (9-12ç‚¹)": { total: 0, count: 0 }, "ä¸­åˆ (12-14ç‚¹)": { total: 0, count: 0 },
            "ä¸‹åˆ (14-18ç‚¹)": { total: 0, count: 0 }, "æ™šä¸Š (18-24ç‚¹)": { total: 0, count: 0 }
        };
        let largestPurchase = null;
        const lifestyleData = { weekday: 0, weekend: 0, total: 0 };
        
        for (const expense of expenses) {
            const amount = Math.abs(expense.amount);
            lifestyleData.total += amount;
            
            if (!categoryData[expense.category]) categoryData[expense.category] = { total: 0, count: 0 };
            categoryData[expense.category].total += amount;
            categoryData[expense.category].count += 1;

            const hour = expense.date.hour;
                 if (hour < 5)  { timeSlotData["å‡Œæ™¨ (0-5ç‚¹)"].total += amount; timeSlotData["å‡Œæ™¨ (0-5ç‚¹)"].count++; }
            else if (hour < 9)  { timeSlotData["æ¸…æ™¨ (5-9ç‚¹)"].total += amount; timeSlotData["æ¸…æ™¨ (5-9ç‚¹)"].count++; }
            else if (hour < 12) { timeSlotData["ä¸Šåˆ (9-12ç‚¹)"].total += amount; timeSlotData["ä¸Šåˆ (9-12ç‚¹)"].count++; }
            else if (hour < 14) { timeSlotData["ä¸­åˆ (12-14ç‚¹)"].total += amount; timeSlotData["ä¸­åˆ (12-14ç‚¹)"].count++; }
            else if (hour < 18) { timeSlotData["ä¸‹åˆ (14-18ç‚¹)"].total += amount; timeSlotData["ä¸‹åˆ (14-18ç‚¹)"].count++; }
            else                { timeSlotData["æ™šä¸Š (18-24ç‚¹)"].total += amount; timeSlotData["æ™šä¸Š (18-24ç‚¹)"].count++; }

            if (!largestPurchase || amount > Math.abs(largestPurchase.amount)) {
                largestPurchase = expense;
            }

            const dayOfWeek = expense.date.weekday;
            if (dayOfWeek >= 1 && dayOfWeek <= 5) {
                lifestyleData.weekday += amount;
            } else {
                lifestyleData.weekend += amount;
            }
        }

        const sortedTimeSlots = Object.entries(timeSlotData).filter(([,d])=>d.total > 0).sort(([,a],[,b]) => b.total - a.total);
        const topByCount = Object.entries(categoryData).sort(([,a],[,b]) => b.count - a.count).slice(0, 3);
        
        const grid = container.createEl('div', { cls: 'analysis-grid' });

        if (sortedTimeSlots.length > 0) {
            const card = grid.createEl('div', { cls: 'analysis-card' });
            card.createEl('h4', { text: 'ğŸ•’ æ¶ˆè´¹èŠ‚å¾‹', cls: 'gradient-title-expense' });
            const list = card.createEl('ul');
            sortedTimeSlots.forEach(([name, data]) => {
                const percentage = lifestyleData.total > 0 ? ((data.total / lifestyleData.total) * 100).toFixed(1) : 0;
                list.createEl('li').innerHTML = `${name}: <b>${this.config.currencySymbol}${formatMoney(data.total)}</b> (${percentage}%)ï¼Œå…± ${data.count} æ¬¡`;
            });
            card.createEl('p', { cls: 'analysis-insight', text: `â€œ${sortedTimeSlots[0][0]}â€æ˜¯æ‚¨çš„æ¶ˆè´¹é«˜å³°æ—¶æ®µï¼Œæˆ–è®¸å¯ä»¥å…³æ³¨ä¸‹æ­¤æ—¶æ®µçš„éå¿…è¦å¼€æ”¯ã€‚` });
        }

        if (largestPurchase) {
            const card = grid.createEl('div', { cls: 'analysis-card' });
            card.createEl('h4', { text: 'ğŸ’¸ æœ€å¤§å•ç¬”', cls: 'gradient-title-expense' });
            card.createEl('p').innerHTML = `æ‚¨åœ¨ <b>${largestPurchase.date.toFormat("Mæœˆdæ—¥")}</b>ï¼Œå›  â€œ${largestPurchase.note || 'æœªå¤‡æ³¨'}â€ åœ¨ <b>${largestPurchase.category}</b> åˆ†ç±»ä¸‹æœ‰ä¸€ç¬”é‡‘é¢ä¸º <b>${this.config.currencySymbol}${formatMoney(Math.abs(largestPurchase.amount))}</b> çš„å¤§é¢æ”¯å‡ºã€‚`;
            card.createEl('p', { cls: 'analysis-insight', text: 'è¿™ç¬”é’±èŠ±å¾—å€¼å—ï¼Ÿå®ƒå®šä¹‰äº†æ‚¨ä»Šå¹´çš„æ¶ˆè´¹ä¸Šé™ã€‚' });
        }
        
        const card3 = grid.createEl('div', { cls: 'analysis-card' });
        card3.createEl('h4', { text: 'ğŸ›’ æ¶ˆè´¹æ´»è·ƒåº¦', cls: 'gradient-title-expense' });
        const list3 = card3.createEl('ul');
        topByCount.forEach(([name, data]) => {
            list3.createEl('li').innerHTML = `<b>${name}</b>: å…± ${data.count} æ¬¡`;
        });
        card3.createEl('p', { cls: 'analysis-insight', text: `â€œ${topByCount[0][0]}â€æ˜¯æ‚¨æœ€é¢‘ç¹çš„æ¶ˆè´¹ä¹ æƒ¯ï¼Œé«˜è¾¾ ${topByCount[0][1].count} æ¬¡ã€‚` });

        const card4 = grid.createEl('div', { cls: 'analysis-card' });
        card4.createEl('h4', { text: 'ğŸ“… ç”Ÿæ´»æ–¹å¼åˆ†è§£', cls: 'gradient-title-expense' });
        const weekdayPct = lifestyleData.total > 0 ? (lifestyleData.weekday / lifestyleData.total * 100).toFixed(1) : 0;
        const weekendPct = lifestyleData.total > 0 ? (lifestyleData.weekend / lifestyleData.total * 100).toFixed(1) : 0;
        card4.createEl('p').innerHTML = `å·¥ä½œæ—¥: <b>${this.config.currencySymbol}${formatMoney(lifestyleData.weekday)}</b> (${weekdayPct}%)`;
        card4.createEl('p').innerHTML = `å‘¨æœ«: <b>${this.config.currencySymbol}${formatMoney(lifestyleData.weekend)}</b> (${weekendPct}%)`;
        const barContainer = card4.createEl('div', { cls: 'lifestyle-bar-container' });
        barContainer.createEl('div', { cls: 'lifestyle-bar-fill', attr: { style: `width: ${weekdayPct}%;` } });
        const dominantPeriod = lifestyleData.weekend > lifestyleData.weekday ? 'å‘¨æœ«' : 'å·¥ä½œæ—¥';
        const dominantPercent = lifestyleData.total > 0 ? (Math.max(lifestyleData.weekday, lifestyleData.weekend) / lifestyleData.total * 100).toFixed(0) : 0;
        card4.createEl('p', { cls: 'analysis-insight', text: `æ‚¨å€¾å‘äºåœ¨${dominantPeriod}èŠ±è´¹æ›´å¤šï¼Œè¿™å äº†æ‚¨æ€»æ”¯å‡ºçš„${dominantPercent}%ã€‚` });
    }

    renderIncomeAnalysis(container, transactions) {
        const incomes = transactions.filter(t => t.isIncome);
        if (incomes.length < 1) {
            container.createEl('p', { text: 'æœ¬å¹´åº¦æ— æ”¶å…¥è®°å½•ï¼Œæ— æ³•ç”Ÿæˆåˆ†ææŠ¥å‘Šã€‚', attr: { style: 'text-align: center; color: var(--text-muted);' }});
            return;
        }

        let totalIncome = 0;
        let largestIncome = null;
        const incomeByMonth = {};
        const incomeByDay = {};

        for (const income of incomes) {
            const amount = income.amount;
            totalIncome += amount;
            
            if (!largestIncome || amount > largestIncome.amount) {
                largestIncome = income;
            }

            const month = income.date.month;
            if (!incomeByMonth[month]) incomeByMonth[month] = 0;
            incomeByMonth[month] += amount;

            const dayOfWeek = income.date.weekday;
            if (!incomeByDay[dayOfWeek]) incomeByDay[dayOfWeek] = 0;
            incomeByDay[dayOfWeek] += amount;
        }

        const peakMonth = Object.entries(incomeByMonth).sort(([,a],[,b]) => b - a)[0];
        const weekdayMap = ["å‘¨ä¸€", "å‘¨äºŒ", "å‘¨ä¸‰", "å‘¨å››", "å‘¨äº”", "å‘¨å…­", "å‘¨æ—¥"];
        const topIncomeDays = Object.entries(incomeByDay).sort(([,a],[,b]) => b - a).slice(0, 3);

        const grid = container.createEl('div', { cls: 'analysis-grid' });

        if (largestIncome) {
            const card2 = grid.createEl('div', { cls: 'analysis-card' });
            card2.createEl('h4', { text: 'âœ¨ æœ€å¤§å•ç¬”æ”¶å…¥', cls: 'gradient-title-income' });
            card2.createEl('p').innerHTML = `ä»Šå¹´æœ€äº®çœ¼çš„æ—¶åˆ»æ˜¯ <b>${largestIncome.date.toFormat("Mæœˆdæ—¥")}</b>ï¼Œä¸€ç¬”æ¥è‡ª <b>${largestIncome.category}</b>ã€é‡‘é¢ä¸º <b>${this.config.currencySymbol}${formatMoney(largestIncome.amount)}</b> çš„æ”¶å…¥ï¼Œå¤‡æ³¨ä¸ºâ€œ${largestIncome.note || 'ä¸€æ¬¡ç¾å¥½çš„æ”¶è·'}â€ï¼`;
            card2.createEl('p', { cls: 'analysis-insight', text: 'è¿™æ˜¯è¾›å‹¤å·¥ä½œçš„ç»“æœï¼Œä¹Ÿæ˜¯æœªæ¥çš„å¸Œæœ›ã€‚' });
        }

        if (peakMonth) {
            const card3 = grid.createEl('div', { cls: 'analysis-card' });
            card3.createEl('h4', { text: 'ğŸš€ æ”¶å…¥é«˜å³°æœˆä»½', cls: 'gradient-title-income' });
            const monthName = this.dv.luxon.DateTime.fromObject({month: peakMonth[0]}).toFormat('MMMM');
            const percentage = totalIncome > 0 ? ((peakMonth[1] / totalIncome) * 100).toFixed(1) : 0;
            card3.createEl('p').innerHTML = `æ‚¨çš„æ”¶å…¥åœ¨ <b>${monthName}</b> è¾¾åˆ°é¡¶å³°ï¼Œå½“æœˆæ€»è®¡ <b>${this.config.currencySymbol}${formatMoney(peakMonth[1])}</b>ï¼Œå å…¨å¹´æ€»æ”¶å…¥çš„ <b>${percentage}%</b>ã€‚`;
            card3.createEl('p', { cls: 'analysis-insight', text: 'å›é¡¾ä¸€ä¸‹ï¼Œæ˜¯ä»€ä¹ˆè®©è¿™ä¸ªæœˆä¸ä¼—ä¸åŒï¼Ÿ' });
        }

        if(topIncomeDays.length > 0) {
            const card4 = grid.createEl('div', { cls: 'analysis-card' });
            card4.createEl('h4', { text: 'ğŸ—“ï¸ æ”¶å…¥èŠ‚å¥', cls: 'gradient-title-income' });
            const list4 = card4.createEl('ul');
            topIncomeDays.forEach(([day, amount]) => {
                const percentage = totalIncome > 0 ? ((amount / totalIncome) * 100).toFixed(1) : 0;
                list4.createEl('li').innerHTML = `<b>${weekdayMap[day-1]}</b>: <b>${this.config.currencySymbol}${formatMoney(amount)}</b> (${percentage}%)`;
            });
            card4.createEl('p', { cls: 'analysis-insight', text: `æ‚¨çš„ä¸»è¦æ”¶å…¥é›†ä¸­åœ¨${topIncomeDays.map(([d]) => `â€œ${weekdayMap[d-1]}â€`).join('å’Œ')}ã€‚` });
        }
    }
	
    renderAnnualSummary(container, monthlyExpenses, monthlyIncomes, targetYear) {
        const totalExpense = monthlyExpenses.reduce((s, m) => s + m, 0);
        const totalIncome = monthlyIncomes.reduce((s, m) => s + m, 0);

        const prevYearTransactions = this.state.allTransactions.filter(t => t.date.hasSame(targetYear.minus({ years: 1 }), 'year'));
        const prevYearTotalExpense = Math.abs(prevYearTransactions.filter(t => !t.isIncome).reduce((sum, t) => sum + t.amount, 0));
        const prevYearTotalIncome = prevYearTransactions.filter(t => t.isIncome).reduce((sum, t) => sum + t.amount, 0);
		        
		const prevYearActiveMonths = 12; // å‡è®¾ä¸Šä¸€å¹´æ˜¯å®Œæ•´çš„12ä¸ªæœˆ
		const prevYearAvgExpense = prevYearTransactions.length > 0 ? prevYearTotalExpense / prevYearActiveMonths : 0;
		const prevYearNetIncome = prevYearTotalIncome - prevYearTotalExpense;

        const activeMonths = targetYear.year === this.dv.luxon.DateTime.now().year ? this.dv.luxon.DateTime.now().month : 12;
        const avgExpense = activeMonths > 0 ? totalExpense / activeMonths : 0;
        const netIncome = totalIncome - totalExpense;
        const summaryEl = container.createEl('div', { cls: 'annual-summary' });
        const CS = this.config.currencySymbol;
        
        const createSummaryItem = (label, value, color = 'var(--text-normal)', yoyData = null) => {
            const item = summaryEl.createEl('div');
            item.createEl('div', { text: label, cls: 'summary-label' });
            item.createEl('div', { text: value, cls: 'summary-value large', attr: {style: `color: ${color}`} });
            if (yoyData && prevYearTransactions.length > 0) {
                const growth = this._calculateGrowth(yoyData.current, yoyData.previous, yoyData.type);
                item.createEl('div', { text: `åŒæ¯” ${growth.text}`, cls: `growth-indicator ${growth.class}`});
            }
        };

        createSummaryItem('å¹´åº¦æ€»æ”¯å‡º', `${CS}${formatMoney(totalExpense)}`, 'var(--text-normal)', {current: totalExpense, previous: prevYearTotalExpense, type: 'expense'});
        createSummaryItem('å¹´åº¦æ€»æ”¶å…¥', `${CS}${formatMoney(totalIncome)}`, 'var(--color-green)', {current: totalIncome, previous: prevYearTotalIncome, type: 'income'});
		
		createSummaryItem('æœˆå‡æ¶ˆè´¹', `${CS}${formatMoney(avgExpense)}`, 'var(--text-normal)', {current: avgExpense, previous: prevYearAvgExpense, type: 'expense'});
		createSummaryItem('å¹´åº¦å‡€æ”¶å…¥', `${netIncome >= 0 ? '+' : ''}${CS}${formatMoney(netIncome)}`, netIncome >= 0 ? 'var(--color-green)' : 'var(--color-red)', {current: netIncome, previous: prevYearNetIncome, type: 'income'});
    }

	renderToggleSwitch(container, viewType) {
	    const switchContainer = container.createEl('div', { attr: { class: 'toggle-switch-container' } });
	    const switchEl = switchContainer.createEl('div', { attr: { class: 'toggle-switch' } });
	    const activeBg = switchEl.createEl('div', { cls: 'toggle-switch-active-bg' });
	    const expenseOption = switchEl.createEl('div', { text: 'æ”¯å‡º', attr: { class: 'toggle-switch-option' } });
	    const incomeOption = switchEl.createEl('div', { text: 'æ”¶å…¥', attr: { class: 'toggle-switch-option' } });
	    
        const setActiveState = (isIncome) => {
	        expenseOption.classList.toggle('active', !isIncome);
	        incomeOption.classList.toggle('active', isIncome);
	        activeBg.style.transform = isIncome ? 'translateX(100%)' : 'translateX(0)';
	    };
	    
        setActiveState(this.state.showIncome);

	    expenseOption.onclick = () => {
	        if (this.state.showIncome) {
                this.state.showIncome = false;
                setActiveState(false);
                this._updateDynamicContent();
            }
	    };
	    incomeOption.onclick = () => {
	        if (!this.state.showIncome) {
                this.state.showIncome = true;
                setActiveState(true);
                this._updateDynamicContent();
            }
	    };
	}

    renderSearchView() {
        const container = this.elements.searchContainer;
        container.innerHTML = '';
        const searchWrapper = container.createEl('div');
        const searchBarContainer = searchWrapper.createEl('div', { attr: { style: 'display: flex; gap: 10px; margin-bottom: 15px;' } });
        const searchInput = searchBarContainer.createEl('input', { type: 'text', placeholder: 'ğŸ” æœç´¢å¤‡æ³¨ã€åˆ†ç±»ã€é‡‘é¢...', value: this.state.searchQuery, cls: 'search-input' });
        const sortSelect = searchBarContainer.createEl('select', { cls: 'sort-select' });
        sortSelect.innerHTML = `<option value="time_desc">æ—¶é—´é™åº</option><option value="time_asc">æ—¶é—´å‡åº</option><option value="amount_desc">é‡‘é¢é™åº</option><option value="amount_asc">é‡‘é¢å‡åº</option>`;
        sortSelect.value = this.state.searchSort || 'time_desc';
        const resultsCard = searchWrapper.createEl('div', { cls: 'details-card', attr: { style: 'padding: 0 15px;' } });
        const resultsContainer = resultsCard.createEl('div');
        const performSearch = () => {
            const query = searchInput.value;
            if (!query) {
                resultsCard.style.display = 'block';
                resultsContainer.innerHTML = `<p style="text-align:center; color: var(--text-muted); padding: 20px 0;">è¯·è¾“å…¥å…³é”®è¯å¼€å§‹æœç´¢</p>`;
                return;
            }
            const lowerQuery = query.toLowerCase();
            this.state.searchQuery = query;
            this.state.searchSort = sortSelect.value;
            resultsCard.style.display = 'block';
            let transactions = this.state.allTransactions.filter(t => { const searchableText = `${t.category} ${t.note} ${t.amount} ${t.date.toFormat("Mæœˆdæ—¥")}`.toLowerCase(); return searchableText.includes(lowerQuery); });
            switch (sortSelect.value) {
                case 'time_desc':   transactions.sort((a,b)=>b.date.toMillis()-a.date.toMillis()||b.time.localeCompare(a.time)); break;
                case 'time_asc':    transactions.sort((a,b)=>a.date.toMillis()-b.date.toMillis()||a.time.localeCompare(b.time)); break;
                case 'amount_desc': transactions.sort((a, b) => Math.abs(b.amount) - Math.abs(a.amount)); break;
                case 'amount_asc':  transactions.sort((a, b) => Math.abs(a.amount) - Math.abs(b.amount)); break;
            }
            this.renderTransactionList(resultsContainer, transactions, query);
        };
        searchInput.oninput = performSearch;
        sortSelect.onchange = performSearch;
        performSearch();
        searchInput.focus();
    }

    _createOverlay(className = 'picker-container') {
        const overlay = document.body.createEl('div', { cls: 'picker-overlay' });
        const container = overlay.createEl('div', { cls: className });
        const close = () => { overlay.classList.remove('visible'); setTimeout(() => overlay.remove(), 200); };
        setTimeout(() => overlay.classList.add('visible'), 10);
        return { overlay, container, close };
    }

	showTransactionsModal(title, transactions) {
	    const categoryName = title.split(' '); this.state.openModalInfo = { type: 'category', category: categoryName[0] };
	    const { container, close, overlay } = this._createOverlay('transactions-modal');
	    const header = container.createEl('div', { cls: 'transactions-header' });
	    header.createEl('div', { text: title, cls: 'transactions-title' });
	    const closeBtn = header.createEl('button', { text: 'Ã—', cls: 'transactions-close' });
	    const content = container.createEl('div', { cls: 'transactions-content' }); content.id = 'active-modal-content-area';
	    this.renderTransactionList(content, transactions);
	    const cleanupAndClose = () => {
            if (this.modalCleanupStack[this.modalCleanupStack.length - 1] === cleanupAndClose) { this.modalCleanupStack.pop(); }
	        this.state.openModalInfo = null;
	        close();
	    };
	    closeBtn.onclick = cleanupAndClose;
	    overlay.onclick = (e) => { if (e.target === overlay) { cleanupAndClose(); } };
	    this.modalCleanupStack.push(cleanupAndClose);
	}

    showMonthPicker(currentDate) {
        let pickerYear = currentDate.year;
        const update = (title, grid, closeFn) => {
            title.textContent = `${pickerYear}å¹´`; grid.className = 'picker-grid'; grid.innerHTML = '';
            for (let i = 1; i <= 12; i++) {
                const item = grid.createEl('div', { text: `${i}æœˆ`, cls: 'picker-grid-item' });
                if (pickerYear === currentDate.year && i === currentDate.month) item.classList.add('selected');
                item.onclick = () => { const now = this.dv.luxon.DateTime.now(); this.state.monthOffset = (pickerYear - now.year) * 12 + (i - now.month); this.renderMonthlyView(); closeFn(); };
            }
        };
        const { container, close } = this._createOverlay();
        const header = container.createEl('div', { cls: 'picker-header' });
        const prevBtn = header.createEl('button', { text: 'â€¹' }); const title = header.createEl('div', { cls: 'picker-title' }); const nextBtn = header.createEl('button', { text: 'â€º' });
        const grid = container.createEl('div');
        prevBtn.onclick = () => { pickerYear--; update(title, grid, close); }; nextBtn.onclick = () => { pickerYear++; update(title, grid, close); };
        update(title, grid, close);
    }

    showYearPicker(currentDate) {
        let centralYear = currentDate.year;
        const update = (title, grid, closeFn) => {
            const startYear = centralYear - 5; title.textContent = `${startYear} - ${startYear + 6}`;
            grid.className = 'picker-grid year-grid'; grid.innerHTML = '';
            for (let i = 0; i < 12; i++) {
                const year = startYear + i; const item = grid.createEl('div', { text: year, cls: 'picker-grid-item' });
                if (year === currentDate.year) item.classList.add('selected');
                item.onclick = () => { this.state.yearOffset = year - this.dv.luxon.DateTime.now().year; this.renderAnnualView(); closeFn(); };
            }
        };
        const { container, close } = this._createOverlay();
        const header = container.createEl('div', { cls: 'picker-header' });
        const prevBtn = header.createEl('button', { text: 'â€¹' }); const title = header.createEl('div', { cls: 'picker-title' }); const nextBtn = header.createEl('button', { text: 'â€º' });
        const grid = container.createEl('div');
        prevBtn.onclick = () => { centralYear -= 12; update(title, grid, close); }; nextBtn.onclick = () => { centralYear += 12; update(title, grid, close); };
        update(title, grid, close);
    }

	showNoteEditorModal(item) {
	    const { container, close, overlay } = this._createOverlay(); 
	    const initialDate = this.dv.luxon.DateTime.fromObject(item.date.toObject());
	    const initialAmount = Math.abs(item.amount);
	    const initialNote = item.note || '';
	    const initialType = item.isIncome ? 'income' : 'expense';
	    const initialCategory = item.category;
	
	    container.createEl('h3', { text: 'ç¼–è¾‘äº¤æ˜“è®°å½•', attr: {style: 'text-align: center;'} });
	    const form = container.createEl('div', { cls: 'edit-form' });
	    
        const amountDateSection = form.createEl('div', { cls: 'form-section', attr: { style: 'display: flex; gap: 10px; align-items: flex-end;' }});
        const amountWrapper = amountDateSection.createEl('div', { attr: { style: 'flex-grow: 1;' }});
        amountWrapper.createEl('label', { text: 'é‡‘é¢' });
        const amountInput = amountWrapper.createEl('input', { type: 'number', value: initialAmount.toFixed(2), cls: 'edit-modal-input' });
        
        const dateWrapper = amountDateSection.createEl('div', { attr: { style: 'flex-shrink: 0;' }});
        dateWrapper.createEl('label', { text: 'æ—¥æœŸ' });
        const dateInput = dateWrapper.createEl('input', { type: 'date', value: initialDate.toFormat('yyyy-MM-dd'), cls: 'edit-modal-input' });

	    form.createEl('div', { cls: 'form-section' }).innerHTML = `<label>å¤‡æ³¨(ä¸å¯æ¢è¡Œ)</label>`; const noteTextarea = form.lastChild.createEl('textarea', { text: initialNote, cls: 'edit-modal-textarea' });
	    const typeCategorySection = form.createEl('div', { attr: { style: 'display: flex; gap: 10px;' } });
	    const typeSection = typeCategorySection.createEl('div', { cls: 'form-section', attr: { style: 'flex: 1;' } }); typeSection.createEl('label', { text: 'ç±»å‹' }); const typeSelect = typeSection.createEl('select', { cls: 'edit-modal-select' }); typeSelect.innerHTML = `<option value="expense">æ”¯å‡º</option><option value="income">æ”¶å…¥</option>`; typeSelect.value = initialType;
	    const categorySection = typeCategorySection.createEl('div', { cls: 'form-section', attr: { style: 'flex: 1;' } }); categorySection.createEl('label', { text: 'åˆ†ç±»' }); const categorySelect = categorySection.createEl('select', { cls: 'edit-modal-select' });
	    
        const populateCategoryOptions = () => {
            let options = typeSelect.value === 'income' 
                ? this.config.incomeCategories 
                : this.config.expenseCategories.filter(cat => cat !== 'æœªåˆ†ç±»');
            if (!options || options.length === 0) options = ["æœªåˆ†ç±»"];
            categorySelect.innerHTML = options.map(c => `<option value="${c}">${c}</option>`).join('');
            return options;
        };
        typeSelect.onchange = () => {
            const newOptions = populateCategoryOptions();
            if (!newOptions.includes(categorySelect.value)) {
                categorySelect.value = newOptions[0] || 'æœªåˆ†ç±»';
                new Notice('âš ï¸ ç±»åˆ«å·²é‡ç½®ï¼Œå› ä¸ºå®ƒä¸é€‚ç”¨äºå½“å‰ç±»å‹ã€‚', 3000);
            }
        };
        populateCategoryOptions();
        categorySelect.value = initialCategory;
	
	    const footer = container.createEl('div', { attr: { style: 'display: flex; justify-content: space-between; margin-top: 20px;' } });
	    const deleteBtn = footer.createEl('button', { text: 'åˆ é™¤', cls: 'delete-btn' }); 
	    const rightButtons = footer.createEl('div', { cls: 'edit-modal-buttons' }); 
	    const cancelBtn = rightButtons.createEl('button', { text: 'å–æ¶ˆ', cls: 'cancel-btn' });
	    const saveBtn = rightButtons.createEl('button', { text: 'ä¿å­˜', cls: 'confirm-btn' });
	
	    const handleLocalKeys = (event) => {
	        if (event.key === 'Enter' && !event.shiftKey) {
	            if (document.activeElement === saveBtn || document.activeElement === cancelBtn || document.activeElement === deleteBtn) return;
	            event.preventDefault(); saveAction();
	        }
	    };
	    const cleanupAndClose = () => {
	        document.removeEventListener('keydown', handleLocalKeys); 
	        if (this.modalCleanupStack[this.modalCleanupStack.length - 1] === cleanupAndClose) { this.modalCleanupStack.pop(); }
	        close();
	    };
	    const saveAction = async () => {
	        const currentAmount = parseFloat(amountInput.value);
	        const currentDate = this.dv.luxon.DateTime.fromISO(dateInput.value);
	        const currentNote = noteTextarea.value.replace(/\n/g, ' ').trim();
	        const currentType = typeSelect.value;
	        const currentCategory = categorySelect.value;
	        const isUnchanged = Math.abs(currentAmount - initialAmount) < 0.001 && 
                              currentNote === initialNote.trim() && 
                              currentType === initialType && 
                              currentCategory === initialCategory &&
                              currentDate.hasSame(initialDate, 'day');
	        if (isUnchanged) { cleanupAndClose(); return; }
	        if (isNaN(currentAmount) || currentAmount <= 0) { new Notice('âŒ é‡‘é¢å¿…é¡»æ˜¯å¤§äº0çš„æ•°å­—'); return; }
	        await this.saveTransaction({ ...item, date: currentDate, amount: currentType === 'income' ? currentAmount : -currentAmount, category: currentCategory, note: currentNote });
	        cleanupAndClose();
	    };
	    saveBtn.onclick = saveAction;
	    cancelBtn.onclick = cleanupAndClose;
	    deleteBtn.onclick = async () => { if (await this.showConfirmationModal('ç¡®è®¤åˆ é™¤', 'æ‚¨ç¡®å®šè¦æ°¸ä¹…åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) { await this.deleteTransaction(item.lineNumber); cleanupAndClose(); } };
	    overlay.onclick = (e) => { if (e.target === overlay) { cleanupAndClose(); } };
	    document.addEventListener('keydown', handleLocalKeys);
	    this.modalCleanupStack.push(cleanupAndClose); 
	}

    showConfirmationModal(title, message) { 
        return new Promise(resolve => {
            const { container, close, overlay } = this._createOverlay(); 
            container.classList.add('confirmation-modal-content'); 
            container.createEl('h3', { text: title }); 
            container.createEl('p', { text: message, attr: { style: 'margin: 15px 0;' } });
            
            const cleanupAndClose = (result) => {
                if (this.modalCleanupStack[this.modalCleanupStack.length - 1] === cleanupAndClose) { this.modalCleanupStack.pop(); }
                close();
                resolve(result);
            };

            const buttons = container.createEl('div', { cls: 'confirmation-buttons' }); 
            buttons.createEl('button', { text: 'å–æ¶ˆ', cls: 'cancel-btn' }).onclick = () => cleanupAndClose(false); 
            buttons.createEl('button', { text: 'ç¡®è®¤', cls: 'confirm-btn' }).onclick = () => cleanupAndClose(true);
            overlay.onclick = (e) => { if (e.target === overlay) { cleanupAndClose(false); } };
            
            this.modalCleanupStack.push(() => cleanupAndClose(false));
        });
    }

    renderCategoryList(container, transactions, totalAmount) {
        const categoryTotals = {};
        transactions.forEach(t => { 
            if (!categoryTotals[t.category]) categoryTotals[t.category] = { amount: 0, count: 0, items: [] }; 
            const amount = Math.abs(t.amount);
            categoryTotals[t.category].amount += amount;
            categoryTotals[t.category].count += 1;
            categoryTotals[t.category].items.push(t); 
        });
        const sorted = Object.entries(categoryTotals).sort(([,a],[,b]) => b.amount - a.amount);
        if (sorted.length === 0) { container.createEl('p', {text: "æ— ç›¸å…³åˆ†ç±»è®°å½•", attr: {style: 'text-align: center; color: var(--text-muted); padding: 15px 0;'}}); return; }
        const listEl = container.createEl('div', { attr: { style: 'margin-top: 25px; display: flex; flex-direction: column; gap: 22px;' } });
        const CS = this.config.currencySymbol;
        sorted.forEach(([category, details]) => {
            const { amount, count, items } = details; 
            const percentage = totalAmount > 0 ? (amount / totalAmount) * 100 : 0;
            const itemEl = listEl.createEl('div', { attr: { style: 'cursor: pointer;' } }); 
            itemEl.onclick = () => this.showTransactionsModal(`${category} (${count}ç¬”)`, items);
            const firstLine = itemEl.createEl('div', { attr: { style: 'display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 4px;' } });
            const sign = this.state.showIncome ? '+' : '-';
            const color = this.state.showIncome ? 'var(--color-green)' : 'var(--color-red)';
            firstLine.innerHTML = `<div><span style="font-size: 0.95em; font-weight: 500;">${category}</span><span style="font-size: 0.8em; color: var(--text-faint, var(--text-muted)); margin-left: 6px;">${percentage.toFixed(1)}%</span></div><span style="font-size: 0.95em; font-family: monospace; color: ${color};">${sign}${CS}${formatMoney(amount)}</span>`;
            const bar = itemEl.createEl('div', { attr: { style: 'width: 100%; background-color: var(--background-modifier-border); border-radius: 4px; height: 6px;' } });
            bar.createEl('div', { attr: { style: `width: ${percentage}%; height: 100%; background-color: ${this.config.categoryColors[category] || '#ccc'}; border-radius: 4px;` } });
        });
    }

    renderTransactionList(container, transactions, query = '') {
        container.innerHTML = '';
        if (transactions.length === 0) { container.innerHTML = '<p style="text-align:center; color: var(--text-muted); padding: 20px 0;">æ— ç›¸å…³è®°å½•</p>'; return; }
        transactions.forEach(item => {
            const itemEl = container.createEl('div', { cls: 'transaction-item-container', attr: { style: 'padding: 8px 4px; cursor: pointer; border-radius: 4px; transition: background-color 0.2s ease; margin: 2px 0;' } });
            itemEl.onclick = () => this.showNoteEditorModal(item); itemEl.onmouseenter = () => { itemEl.style.backgroundColor = 'var(--background-modifier-hover, #f0f0f0)'; }; itemEl.onmouseleave = () => { itemEl.style.backgroundColor = 'transparent'; };
            const firstLine = itemEl.createEl('div', { attr: { style: 'display: flex; justify-content: space-between; align-items: center;' } });
            firstLine.innerHTML = `<span style="font-size: 0.95em; font-weight: 500;">${highlightText(item.category, query)}</span><span style="font-size: 0.95em; font-family: monospace; color: ${item.isIncome ? 'var(--color-green)':'var(--color-red)'};">${highlightText(`${item.isIncome ? '+':''}${this.config.currencySymbol}${formatMoney(item.amount)}`, query)}</span>`;
            const secondLine = itemEl.createEl('div', { attr: { style: 'display: flex; justify-content: space-between; align-items: baseline; margin-top: 2px;' } });
            const noteContainer = secondLine.createEl('div', { cls: 'note-container' });
            const noteTextEl = noteContainer.createEl('span', { cls: 'note-text', attr: { style: 'font-size: 0.85em; color: var(--text-muted);' } });
            const noteContent = item.note || 'ç‚¹å‡»æ·»åŠ å¤‡æ³¨';
            noteTextEl.innerHTML = highlightText(noteContent, query);
            noteTextEl.setAttribute('title', noteContent);
            secondLine.createEl('span', { attr: { style: 'font-size: 0.85em; color: var(--text-muted); flex-shrink: 0; margin-left: 10px;' } }).innerHTML = `${highlightText(item.date.toFormat("yyå¹´Mæœˆdæ—¥"), query)} ${item.time}`;
        });
    }

    renderTrendChart(containerId, labels, expenseData, incomeData) {
        setTimeout(() => {
            const el = document.getElementById(containerId);
            if (!el) return;
            if (typeof renderChart === 'undefined') {
                el.innerHTML = `<div style="text-align:center; padding: 20px; color: var(--text-muted);">âš ï¸ **è­¦å‘Šï¼š** æœªå®‰è£…æˆ–å¯ç”¨ <code>Obsidian Charts</code> æ’ä»¶ï¼Œæ— æ³•æ¸²æŸ“å›¾è¡¨ã€‚</div>`;
                return;
            }
            const createGradient = (ctx, chartArea, color) => { if (!chartArea) return null; const gradient = ctx.createLinearGradient(0, chartArea.top, 0, chartArea.bottom); gradient.addColorStop(0, color.replace(')', ', 0.4)').replace('rgb', 'rgba')); gradient.addColorStop(1, color.replace(')', ', 0)').replace('rgb', 'rgba')); return gradient; };
            const data = { type:'line', data:{ labels, datasets:[{label:'æ”¯å‡º',data:expenseData,borderColor:'rgb(255,99,132)',backgroundColor:c=>createGradient(c.chart.ctx,c.chart.chartArea,'rgb(255,99,132)'),fill:true,tension:0.4},{label:'æ”¶å…¥',data:incomeData,borderColor:'rgb(45,211,111)',backgroundColor:c=>createGradient(c.chart.ctx,c.chart.chartArea,'rgb(45,211,111)'),fill:true,tension:0.4}] }, options:{ responsive:true,maintainAspectRatio:false,scales:{y:{beginAtZero:true}},interaction:{intersect:false,mode:'index'},plugins:{legend:{labels:{usePointStyle:true,boxWidth:8}, onClick: null}}} };
            try { renderChart(data, el); } catch (e) { el.setText(`âŒ å›¾è¡¨æ¸²æŸ“å¤±è´¥: ${e.message}`); }
        }, 100);
    }

    async parseTransactionData() {
        const file = this.app.vault.getAbstractFileByPath(this.config.filePath); if (!file) return null;
        const content = await this.app.vault.read(file);
        const lines = content.split('\n');
        const transactions = [];
        const regex = /^- \[(\d{2}-\d{2}-\d{2})\]\s*\[([^:]+?)\s*:\s*([^\|]*?)\s*\|\s*([\+\-]?\d+(?:\.\d+)?)\]\s*\[(\d{2}:\d{2})\]$/;
        let malformedLines = 0;
        for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim(); if (!line) continue;
            const match = line.match(regex);
            if (match) {
                const amount = parseFloat(match[4]);
                if (isNaN(amount) || amount === 0) { 
                    if (isNaN(amount)) malformedLines++; 
                    console.warn(`[æ¶ˆè´¹ä»ªè¡¨ç›˜] ç¬¬ ${i+1}è¡Œ è·³è¿‡ï¼šæ— æ•ˆæˆ–ä¸ºé›¶çš„é‡‘é¢ "${match[4]}"`); 
                    continue; 
                }
                
                let year = parseInt(match[1].substring(0, 2), 10);
                year += (year < 50) ? 2000 : 1900;
                const month = parseInt(match[1].substring(3, 5), 10);
                const day = parseInt(match[1].substring(6, 8), 10);
                const dateObj = this.dv.luxon.DateTime.fromObject({ year, month, day, hour: parseInt(match[5].substring(0,2)), minute: parseInt(match[5].substring(3,5)) });

                transactions.push({ date: dateObj, category:match[2].trim()||'æœªåˆ†ç±»', note:match[3].trim()||'', amount, time:match[5], lineNumber:i, raw:lines[i], isIncome:amount>0 });
            } else { malformedLines++; console.warn(`[æ¶ˆè´¹ä»ªè¡¨ç›˜] ç¬¬ ${i+1}è¡Œ æ ¼å¼ä¸åŒ¹é…: "${line}"`); }
        } 
        if (malformedLines > 0) { new Notice(`${malformedLines} æ¡è®°å½•æ ¼å¼ä¸æ­£ç¡®ï¼Œå·²è¢«å¿½ç•¥ã€‚\nè¯¦æƒ…è¯·æŸ¥çœ‹å¼€å‘è€…æ§åˆ¶å°ã€‚`, 7000); }
        return transactions;
    }

    async saveTransaction(item) {
        const { lineNumber, date, category, note, amount, time } = item;
        const amountStr = (amount > 0 ? `+${amount.toFixed(2)}` : amount.toFixed(2));
        const newLine = `- [${date.toFormat("yy-MM-dd")}][${category}:${note}|${amountStr}][${time}]`;
        await this._modifyLineInFile(lineNumber, newLine, "âœ… å·²æ›´æ–°è®°å½•");
    }

    async deleteTransaction(lineNumber) { await this._modifyLineInFile(lineNumber, null, "âœ… å·²åˆ é™¤è®°å½•"); }

    async _refreshDataAndRender() {
        this.state.allTransactions = await this.parseTransactionData();
        
        if (this.state.activeView === 'search') {
            this.renderSearchView();
        } else {
            this.switchView(this.state.activeView);
        }
        
        if (this.state.openModalInfo && this.state.openModalInfo.type === 'category') {
            const modalContentEl = document.getElementById('active-modal-content-area'); const modalTitleEl = document.querySelector('.transactions-modal .transactions-title');
            if (modalContentEl && modalTitleEl) {
                const categoryName = this.state.openModalInfo.category; let currentViewTransactions;
                if (this.state.activeView === 'monthly') { const targetMonth = this.dv.luxon.DateTime.now().plus({ months: this.state.monthOffset }); currentViewTransactions = this.state.allTransactions.filter(t => t.date.hasSame(targetMonth, 'month'));
                } else { const targetYear = this.dv.luxon.DateTime.now().plus({ years: this.state.yearOffset }); currentViewTransactions = this.state.allTransactions.filter(t => t.date.hasSame(targetYear, 'year')); }
                const newTransactionsForModal = currentViewTransactions.filter(t => t.category === categoryName);
                if (newTransactionsForModal.length === 0) { const modal = document.querySelector('.transactions-modal'); if (modal) modal.parentElement.remove(); this.state.openModalInfo = null; return; }
                const newTotalAmount = newTransactionsForModal.reduce((sum, t) => sum + t.amount, 0);
                const count = newTransactionsForModal.length;
                const newTitle = `${categoryName} (${count}ç¬”) - ${this.config.currencySymbol}${formatMoney(Math.abs(newTotalAmount))}`;
                modalTitleEl.textContent = newTitle; this.renderTransactionList(modalContentEl, newTransactionsForModal);
            }
        }
    }

    async _modifyLineInFile(lineNumber, newLineContent, noticeMsg) {
        try {
            const file = this.app.vault.getAbstractFileByPath(this.config.filePath); if (!file) throw new Error("æ—¥å¿—æ–‡ä»¶æœªæ‰¾åˆ°");
            let lines = (await this.app.vault.read(file)).split('\n'); if (lineNumber >= lines.length) throw new Error("è¡Œå·é”™è¯¯");
            newLineContent === null ? lines.splice(lineNumber, 1) : lines[lineNumber] = newLineContent;
            await this.app.vault.modify(file, lines.join('\n'));
            if (noticeMsg) new Notice(noticeMsg); await this._refreshDataAndRender();
        } catch (e) { new Notice(`âŒ æ“ä½œå¤±è´¥: ${e.message}`); console.error(e); }
    }
    
	addGlobalStyles() {
	    const styleId = 'finance-dashboard-global-style-v2.3.0';
	    document.querySelectorAll('[id^="finance-dashboard-global-style"]').forEach(el => { if (el.id !== styleId) el.remove(); });
	    if (document.getElementById(styleId)) return;
	
	    const style = document.createElement('style');
	    style.id = styleId;
	    style.innerHTML = `
	        :root { --control-radius: 20px; }
	        .content-card { background-color: var(--background-secondary, #2a2a2a); background-image: linear-gradient(to bottom, var(--background-secondary-alt, #3a3a3a), var(--background-secondary, #2a2a2a)); border-radius: 12px; padding: 25px; border: 1px solid var(--background-modifier-border, #444); box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
	        .divider { border: none; border-top: 1px solid var(--background-modifier-border, #444); margin: 30px 0 20px; }
	        .section-title { margin-bottom: 15px; font-size: 1.1em; font-weight: 600; }
	        .main-nav-button { background-color: var(--background-secondary-alt, #3a3a3a); border: 1px solid var(--background-modifier-border, #444); border-radius: 8px; padding: 8px 14px; font-size: 0.9em; cursor: pointer; flex-grow: 1; text-align: center; font-weight: 500; transition: all 0.2s ease; }
	        .main-nav-button:hover { background-color: var(--background-modifier-hover, #4a4a4a); }
	        .main-nav-button.active { background-color: var(--interactive-accent, #4e6f9a) !important; color: var(--text-on-accent, white) !important; border-color: var(--interactive-accent-hover, #587db3); }
	        .control-button { padding: 7px 16px; font-size: 0.9em; font-weight: 500; border-radius: var(--control-radius); cursor: pointer; transition: all 0.2s ease; background-color: var(--background-secondary-alt, #3a3a3a); color: var(--text-normal, #ddd); border: 1px solid var(--background-modifier-border, #444); }
	        .control-button:hover { background-color: var(--background-modifier-hover, #4a4a4a); border-color: var(--background-modifier-border-hover, #555); }
	        .control-button.secondary { background-color: transparent; color: var(--text-muted, #999); border-color: transparent; }
	        .control-button.secondary:hover { background-color: var(--background-secondary-alt, #3a3a3a); color: var(--text-normal, #ddd); }
	        .toggle-switch-container { display: flex; justify-content: center; margin-top: 15px; margin-bottom: 30px; }
	        .toggle-switch { position: relative; display: flex; background-color: var(--background-secondary-alt, #3a3a3a); border-radius: var(--control-radius); padding: 4px; border: 1px solid var(--background-modifier-border, #444); }
	        .toggle-switch-active-bg { position: absolute; top: 4px; left: 4px; width: calc(50% - 4px); height: calc(100% - 8px); background-color: var(--interactive-accent, #4e6f9a); border-radius: 16px; box-shadow: 0 2px 6px rgba(0,0,0,0.15); transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
	        .toggle-switch-option { position: relative; z-index: 1; padding: 6px 16px; font-size: 0.9em; font-weight: 500; border-radius: 16px; cursor: pointer; transition: color 0.3s ease; color: var(--text-muted, #999); }
	        .toggle-switch-option.active { color: white; }
	        .search-input { flex: 1; padding: 10px; font-size: 1.1em; border-radius: 8px; border: 1px solid var(--background-modifier-border, #444); background-color: var(--background-primary, #1e1e1e); }
	        .sort-select { padding: 10px; font-size: 0.9em; border-radius: 8px; border: 1px solid var(--background-modifier-border, #444); background-color: var(--background-primary, #1e1e1e); color: var(--text-muted, #999); }
	        .search-highlight { background-image: linear-gradient(to right, rgba(255, 223, 0, 0.6), rgba(255, 190, 0, 0.5)); border-radius: 3px; padding: 0 2px; margin: 0 -2px; color: var(--text-normal, #ddd); }
	        .summary-container { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; justify-content: space-around; text-align: center; margin-bottom: 25px; padding: 12px 0; background-color: var(--background-secondary-alt, #3a3a3a); border-radius: 8px; }
	        .annual-summary { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; text-align: center; margin-bottom: 25px; }
	        /* è¿™é‡Œä¿®æ”¹â€œå¹´åº¦æ€»æ”¶å…¥â€ç­‰å­—æ · */
	        .summary-label { font-size: 0.85em; color: var(--text-muted, #999); margin-bottom: 4px; }
	        .summary-value { font-size: 1.35em; font-weight: 600; color: var(--text-normal, #ddd); }
	        .summary-value.large { font-size: 1.35em; }
	        .summary-value.income { color: var(--color-green, #34d399); }
            /* ç”¨æˆ·è‡ªå®šä¹‰ï¼šåœ¨è¿™é‡Œä¿®æ”¹ç¯æ¯”/åŒæ¯”æŒ‡ç¤ºå™¨çš„æ–‡å­—å¤§å°å’Œé¢œè‰² */
            .growth-indicator { font-size: 0.8em; margin-top: 4px; font-weight: 500; }
            .growth-indicator.positive { color: var(--color-green); }
            .growth-indicator.negative { color: var(--color-red); }
            .growth-indicator.neutral { color: var(--text-faint); }
	        .details-card { background-color: var(--background-secondary-alt, #3a3a3a); border-radius: 8px; padding: 0 15px; }
	        .transaction-item-container { border-top: 1px solid var(--background-modifier-border, #444); }
	        .details-card > div > .transaction-item-container:first-child { border-top: none; }
	        .picker-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); display: flex; justify-content: center; align-items: center; z-index: 1000; opacity: 0; transition: opacity 0.2s ease; }
	        .picker-overlay.visible { opacity: 1; }
	        .picker-container { background-color: var(--background-secondary, #2a2a2a); border: 1px solid var(--background-modifier-border, #444); border-radius: 12px; padding: 15px 20px 25px; width: 90%; max-width: 400px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); transform: scale(0.9); transition: transform 0.2s ease; }
	        .picker-overlay.visible .picker-container { transform: scale(1); }
	        .picker-container h3 { margin-top: 0; margin-bottom: 25px; text-align: center; }
	        .picker-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
	        .picker-header button { font-size: 1.2em; background: none; border: none; cursor: pointer; color: var(--text-normal, #ddd); }
	        .picker-title { font-size: 1.2em; font-weight: bold; text-align: center; }
	        .picker-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
	        .picker-grid.year-grid { grid-template-columns: repeat(4, 1fr); }
	        .picker-grid-item { padding: 12px; text-align: center; border-radius: 8px; background-color: var(--background-secondary-alt, #3a3a3a); cursor: pointer; transition: background-color 0.2s; }
	        .picker-grid-item:hover { background-color: var(--background-modifier-hover, #4a4a4a); }
	        .picker-grid-item.selected { background-color: var(--interactive-accent, #4e6f9a); color: var(--text-on-accent, white); font-weight: bold; }
	        .edit-form { display: flex; flex-direction: column; gap: 15px; }
	        .form-section label { display: block; font-size: 0.9em; color: var(--text-muted, #999); font-weight: 500; margin-bottom: 4px; }
	        .edit-modal-input, .edit-modal-select, .edit-modal-textarea { width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--background-modifier-border, #444); background-color: var(--background-primary, #1e1e1e) !important; font-size: 1em; color: var(--text-normal); }
	        .edit-modal-buttons { display: flex; justify-content: flex-end; gap: 10px; }
	        .edit-modal-buttons button, .delete-btn { padding: 8px 16px; border-radius: 6px; border: none; font-weight: 500; cursor: pointer; }
	        .edit-modal-buttons .confirm-btn { background-color: var(--interactive-accent, #4e6f9a); color: var(--text-on-accent, white); }
	        .edit-modal-buttons .cancel-btn { background-color: var(--background-modifier-border, #444); color: var(--text-normal, #ddd); }
	        .delete-btn { background-color: var(--background-modifier-border, #444) !important; color: var(--text-error, #e57373) !important; transition: background-color 0.2s; }
	        .delete-btn:hover { background-color: var(--color-red, #e53935) !important; color: white !important; }
	        .transactions-modal { background-color: var(--background-secondary, #2a2a2a); border-radius: 12px; border: 1px solid var(--background-modifier-border, #444); box-shadow: 0 5px 25px rgba(0,0,0,0.3); display: flex; flex-direction: column; overflow: hidden; width: 90%; max-width: 800px; max-height: 80vh; }
	        .transactions-header { padding: 15px 20px; background-color: var(--background-secondary-alt, #3a3a3a); border-bottom: 1px solid var(--background-modifier-border, #444); display: flex; justify-content: space-between; align-items: center; }
	        .transactions-title { font-size: 1.2em; font-weight: 600; }
	        .transactions-close { background: none; border: none; font-size: 1.5em; cursor: pointer; color: var(--text-muted, #999); }
	        .transactions-content { padding: 15px; overflow-y: auto; flex-grow: 1; }
	        .confirmation-buttons { display: flex; justify-content: flex-end; gap: 15px; }
	        .note-container { min-width: 0; flex-grow: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
	        .note-text[title] { cursor: help; }
	        .analysis-section-title { text-align: center; font-size: 1.5em; margin-top: 20px; margin-bottom: 25px; }
	        .analysis-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
	        .analysis-card { background-color: var(--background-secondary-alt); border-radius: 10px; padding: 20px; border: 1px solid var(--background-modifier-border); display: flex; flex-direction: column; gap: 10px; }
	        .analysis-card h4 { margin: 0 0 5px 0; font-size: 1.1em; font-weight: 600; }
	        .analysis-card ul { padding-inline-start: 20px; margin: 0; flex-grow: 1; }
	        .analysis-card li { margin-bottom: 5px; }
            .analysis-card b { font-weight: 600; color: inherit; }
	        .analysis-insight { font-size: 0.85em; color: var(--text-muted); margin-top: auto; padding-top: 10px; border-top: 1px solid var(--background-modifier-border); }
            .gradient-title-income { background: linear-gradient(90deg, #67e8f9, #6ee7b7, #5eead4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; color: transparent; }
            .gradient-title-expense { background: linear-gradient(90deg, #facc15, #fb923c, #ef4444); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; color: transparent; }
	        .lifestyle-bar-container { width: 100%; height: 8px; background-color: var(--background-modifier-border); border-radius: 4px; overflow: hidden; margin: 8px 0; }
	        .lifestyle-bar-fill { height: 100%; background-color: var(--interactive-accent); border-radius: 4px; }
	        @media (max-width: 450px) { .edit-form > div[style*="display: flex"] { flex-direction: column; } .annual-summary { grid-template-columns: repeat(2, 1fr); gap: 5px; } .annual-summary .summary-value.large { font-size: 1.0em; } .annual-summary .summary-label { font-size: 0.7em; } }
	    `;
	    document.head.appendChild(style);
	}
	
}

try {
    const dashboard = new FinanceDashboard(dv.container, CONFIG);
    dashboard.init();
} catch (e) {
    dv.container.setText("âŒ Dataview è„šæœ¬æ‰§è¡Œå¤±è´¥: " + e.message);
}
```

</details>

> æç¤ºï¼šä»ªè¡¨ç›˜ä»£ç ä¼šè‡ªåŠ¨ä»ç½‘ç»œåŠ è½½ Chart.js åº“æ¥ç»˜åˆ¶å›¾è¡¨ã€‚å¦‚æœå›¾è¡¨ä¸æ˜¾ç¤ºï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œ Obsidian çš„ç½‘ç»œæƒé™ã€‚

## ç»“è¯­

æˆ‘å°†è‡ªå·±æ‘¸ç´¢å’Œè°ƒè¯•çš„ç»éªŒæµ“ç¼©åœ¨è¿™ç¯‡æ•™ç¨‹é‡Œï¼Œå¸Œæœ›èƒ½è®©ä½ å°‘èµ°å¼¯è·¯ï¼Œç›´æ¥äº«å—æˆæœã€‚å¦‚æœåœ¨é…ç½®æˆ–ä½¿ç”¨ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€äº¤æµã€‚

å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¸å¦¨åˆ†äº«ç»™åŒæ ·çƒ­çˆ± Obsidian å’Œæ•ˆç‡ç”Ÿæ´»çš„æœ‹å‹ä»¬ã€‚

âœ¨â€‹**æ¸©é¦¨æç¤º**â€‹âœ¨

> ä»¥ä¸Šæ‰€æœ‰ä»£ç å‡ä¸ºçº¯ç²¹çš„æœ¬åœ°åŒ–è„šæœ¬ï¼Œæ‰€æœ‰çš„æ•°æ®è¯»å–ã€å¤„ç†å’Œè®¡ç®—éƒ½åœ¨ä½ è‡ªå·±çš„è®¾å¤‡ä¸Šå®Œæˆã€‚
> â€‹æœ€å…³é”®çš„ä¸€ç‚¹ï¼š**å®ƒä¸ä¼šå°†ä½ çš„ä»»ä½•æ•°æ®ä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨ï¼â€‹**â€‹ä½ çš„æ‰€æœ‰æ•°æ®ï¼Œæ°¸è¿œåªå±äºä½ ã€‚

å¦‚æœä½ é‡åˆ°äº†ç¨‹åºé”™è¯¯ï¼Œæˆ–è€…çµå…‰ä¸€ç°æœ‰äº†è¶…æ£’çš„æƒ³æ³•ï¼Œéšæ—¶æ¬¢è¿å‘Šè¯‰æˆ‘ï¼

ğŸ“§ é‚®ä»¶ï¼š[Socrates.02zx@Gmail.com](mailto:Socrates.02zx@Gmail.com)

æ„Ÿè°¢é˜…è¯»ï¼Œç¥ä½ è®°è´¦æ„‰å¿«ï¼:)

## ä»ªè¡¨ç›˜æ•ˆæœå›¾ï¼ˆç¤ºä¾‹ï¼‰

*(è¿™æ˜¯ä¸€ä¸ªæ ¹æ®æè¿°ç”Ÿæˆçš„æ•ˆæœå›¾ç¤ºä¾‹ï¼Œä½ çš„å®é™…ä»ªè¡¨ç›˜ä¼šå®æ—¶åæ˜ ä½ çš„æ•°æ®)*

![dashboard-demo.png](https://i.setix.xyz/attachments/2025/money-log/money-log-01.png) 
![dashboard-demo.png](https://i.setix.xyz/attachments/2025/money-log/money-log-02.png) 
![dashboard-demo.png](https://i.setix.xyz/attachments/2025/money-log/money-log-03.png)
![dashboard-demo.png](https://i.setix.xyz/attachments/2025/money-log/money-log-04.png)
![dashboard-demo.png](https://i.setix.xyz/attachments/2025/money-log/money-log-05.png)
