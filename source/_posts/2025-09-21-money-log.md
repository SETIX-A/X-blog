---
layout: post
title: Obsidian æ¶ˆè´¹è®°è´¦ç»ˆææŒ‡å—ï¼šä»ä¸€é”®å½•å…¥åˆ°è‡ªåŠ¨åŒ–ä»ªè¡¨ç›˜
date: 2025-09-20
categories:
  - Obsidian
tags:
  - Obsidian
  - Dataview
  - Templater
  - ä¸ªäººç†è´¢
draft: true
---

å¤§å®¶å¥½ï¼å¦‚æœä½ ä¹Ÿæ›¾è¢«ç¹ççš„è®°è´¦æµç¨‹æ‰€å›°æ‰°â€”â€”æ¯æ¬¡æ¶ˆè´¹éƒ½è¦æ‰“å¼€ Appã€é€‰æ‹©åˆ†ç±»ã€æ‰‹åŠ¨è¾“å…¥é‡‘é¢ï¼Œæœˆåº•çœ‹ç€å‡Œä¹±çš„è´¦å•å´å¾—ä¸åˆ°ä»»ä½•æœ‰æ•ˆæ´å¯Ÿâ€”â€”é‚£ä¹ˆï¼Œè¿™ç¯‡æ–‡ç« æ­£æ˜¯ä½ çš„â€œè§£è¯â€ã€‚

æˆ‘èŠ±äº†å¤§é‡æ—¶é—´æ¢ç´¢å’Œè¿­ä»£ï¼Œæœ€ç»ˆåœ¨ Obsidian ä¸­æ­å»ºäº†ä¸€å¥—**çœŸæ­£â€œå…¨è‡ªåŠ¨åŒ–â€çš„ä¸ªäººæ¶ˆè´¹è¿½è¸ªç³»ç»Ÿ**ã€‚å®ƒå°†å½»åº•æ”¹å˜ä½ çš„è®°è´¦ä½“éªŒã€‚

ç°åœ¨ï¼Œæˆ‘å°†æ¯«æ— ä¿ç•™åœ°åˆ†äº«ç»™ä½ ã€‚åªéœ€è·Ÿç€æŒ‡å—æ“ä½œï¼Œä½ å°±èƒ½æ‹¥æœ‰ä¸€ä¸ª**â€œä¸€é”®å½•å…¥ã€è‡ªåŠ¨åˆå¹¶ã€æ™ºèƒ½æ’åºâ€**çš„å½•å…¥æ¨¡æ¿ï¼Œä»¥åŠä¸€ä¸ª**â€œå¤šç»´åº¦ã€å¯äº¤äº’ã€å¸¦é¢„è­¦â€**çš„å…¨åŠŸèƒ½è´¢åŠ¡ä»ªè¡¨ç›˜ã€‚

ä¸ºä»€ä¹ˆæ˜¯ Obsidianï¼Ÿå› ä¸ºå®ƒå°†æ•°æ®æ‰€æœ‰æƒ 100% äº¤è¿˜ç»™ä½ ï¼ŒåŒæ—¶é€šè¿‡å¼ºå¤§çš„æ’ä»¶ç”Ÿæ€ï¼Œè®©ä½ çš„æœ¬åœ°ç¬”è®°åº“åŒ–èº«ä¸ºæ— æ‰€ä¸èƒ½çš„ä¸ªäººæ•°æ®ä¸­å¿ƒã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬å¼€å¯é«˜æ•ˆã€æ™ºèƒ½çš„è®°è´¦æ–°çºªå…ƒï¼

## æœ€ç»ˆæ•ˆæœé¢„è§ˆ

æƒ³è±¡ä¸€ä¸‹ä½ ç†æƒ³ä¸­çš„è®°è´¦æµç¨‹ï¼š
1.  **ä¸€é”®å¿«é€Ÿå½•å…¥**ï¼šæ— è®ºä½•æ—¶ä½•åœ°æ¶ˆè´¹ï¼Œåªéœ€æŒ‰ä¸‹å¿«æ·é”®ï¼Œè¾“å…¥é‡‘é¢ï¼ˆç”šè‡³æ”¯æŒ `30+15` è¿™æ ·çš„å¿«æ·è®¡ç®—ï¼‰ï¼Œé€‰æ‹©åˆ†ç±»ï¼Œå³å¯å®Œæˆè®°å½•ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸è¶…è¿‡10ç§’ã€‚
2.  **åŒæ—¥æ¶ˆè´¹è‡ªåŠ¨åˆå¹¶**ï¼šä»Šå¤©å·²ç»è®°è¿‡ä¸€ç¬”å¤–å–ï¼Ÿæ™šä¸Šåˆå»è¶…å¸‚è´­ç‰©ï¼Ÿæ²¡é—®é¢˜ï¼Œå†æ¬¡å½•å…¥åï¼Œè„šæœ¬ä¼šè‡ªåŠ¨æ‰¾åˆ°ä»Šå¤©çš„è®°å½•ï¼Œå°†ä¸¤ç¬”æ¶ˆè´¹**æ™ºèƒ½åˆå¹¶**åˆ°åŒä¸€è¡Œï¼Œæ€»é‡‘é¢è‡ªåŠ¨ç´¯åŠ ã€‚ä½ çš„æ—¥å¿—æ°¸è¿œä¿æŒå¹²å‡€æ•´æ´ã€‚
3.  **å¹´/æœˆæ ‡é¢˜è‡ªåŠ¨åˆ›å»º**ï¼šå½“ä½ è®°å½•ä¸‹æ–°ä¸€å¹´çš„ç¬¬ä¸€ç¬”æ¶ˆè´¹æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºä½ æ’å…¥ä¸€ä¸ªé†’ç›®çš„å¹´ä»½æ ‡é¢˜ï¼ˆå¦‚ `## 2026`ï¼‰ï¼›è®°å½•æ–°æœˆä»½çš„ç¬¬ä¸€ç¬”æ¶ˆè´¹æ—¶ï¼Œåˆ™ä¼šè‡ªåŠ¨æ’å…¥æœˆä»½æ ‡é¢˜ï¼ˆå¦‚ `### 26-01`ï¼‰ã€‚ä½ çš„æ¶ˆè´¹æ—¥å¿—å°†è‡ªåŠ¨æŒ‰æ—¶é—´å±‚çº§å®Œç¾å½’æ¡£ã€‚
4.  **å…¨åŠŸèƒ½è´¢åŠ¡ä»ªè¡¨ç›˜**ï¼šåœ¨ä¸€ä¸ªä¸“å±é¡µé¢ï¼Œä½ å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°ï¼š
    *   **æœˆåº¦/å¹´åº¦å¯åˆ‡æ¢è§†å›¾**ï¼šè½»æ¾å›é¡¾ä¸Šä¸ªæœˆæˆ–å»å¹´çš„æ¶ˆè´¹çŠ¶å†µã€‚
    *   **åŠ¨æ€å›¾è¡¨**ï¼šæ¶ˆè´¹åˆ†ç±»é¥¼å›¾ã€æœˆåº¦æ¶ˆè´¹è¶‹åŠ¿æŠ˜çº¿å›¾ï¼Œä¸€ç›®äº†ç„¶ã€‚
    *   **é¢„ç®—è¶…æ”¯è­¦å‘Š**ï¼šå½“æœˆæ¶ˆè´¹è¶…è¿‡é¢„è®¾ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å‘å‡ºé†’ç›®æé†’ã€‚
    *   **æ·±åº¦æ•°æ®æ´å¯Ÿ**ï¼šè‡ªåŠ¨è®¡ç®—æœˆå‡æ¶ˆè´¹ã€æ¶ˆè´¹æœ€é«˜æœˆä»½ã€æ”¯å‡ºå† å†›ç±»åˆ«ç­‰å…³é”®æŒ‡æ ‡ã€‚

è¿™å¥—ç³»ç»Ÿä¸ä»…ä¸ºä½ çœæ—¶ï¼Œæ›´èƒ½å°†æ¯ç‡¥çš„æ•°æ®è½¬åŒ–ä¸ºå¸®ä½ ä¼˜åŒ–æ¶ˆè´¹ã€å®ç°ç†è´¢ç›®æ ‡çš„å¼ºå¤§åŠ¨åŠ›ã€‚

> **ä»¥ä¸‹æ˜¯ä»ªè¡¨ç›˜æ•ˆæœå›¾ï¼ˆç¤ºä¾‹ï¼‰**

![dashboard-demo.png](https://i.setix.xyz/attachments/2025/09/%E6%B6%88%E8%B4%B9%E4%BB%AA%E8%A1%A8%E7%9B%98_page-0001.jpg) ![dashboard-demo.png](https://i.setix.xyz/attachments/2025/09/%E6%B6%88%E8%B4%B9%E4%BB%AA%E8%A1%A8%E7%9B%98_page-0002.jpg) 
*(è¿™æ˜¯ä¸€ä¸ªæ ¹æ®æè¿°ç”Ÿæˆçš„æ•ˆæœå›¾ç¤ºä¾‹ï¼Œä½ çš„å®é™…ä»ªè¡¨ç›˜ä¼šå®æ—¶åæ˜ ä½ çš„æ•°æ®)*

## æ‰€éœ€å·¥å…·

- [Obsidian](https://obsidian.md/)ï¼ˆå…è´¹ä¸‹è½½è‡ªå®˜ç½‘ï¼‰ã€‚
- **æ’ä»¶**ï¼ˆåœ¨Obsidianè®¾ç½® > ç¤¾åŒºæ’ä»¶ä¸­å®‰è£…å¹¶å¯ç”¨ï¼‰ï¼š
  - **Templater**ï¼šè‡ªåŠ¨åŒ–è„šæœ¬çš„æ ¸å¿ƒå¼•æ“ï¼Œè´Ÿè´£å¤„ç†æ‰€æœ‰çš„æ•°æ®å½•å…¥å’Œæ–‡ä»¶ä¿®æ”¹é€»è¾‘ã€‚
  - **Dataview**ï¼šå¼ºå¤§çš„æ•°æ®æŸ¥è¯¢ä¸å¯è§†åŒ–å·¥å…·ï¼Œè´Ÿè´£é©±åŠ¨æˆ‘ä»¬çš„è´¢åŠ¡ä»ªè¡¨ç›˜ã€‚

è¯·ç¡®ä¿å®‰è£…å¹¶å¯ç”¨ä¸Šè¿°æ’ä»¶åï¼Œé‡å¯ Obsidianã€‚

## Part 1: æ„å»ºæ•°æ®æ ¸å¿ƒ (The Core Data System)

æˆ‘ä»¬çš„ç³»ç»Ÿç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼šä¸€ä¸ªæ™ºèƒ½å½•å…¥æ¨¡æ¿ï¼Œä¸€ä¸ªçº¯æ–‡æœ¬æ—¥å¿—æ–‡ä»¶ï¼Œä»¥åŠä¸€ä¸ªæ•°æ®ä»ªè¡¨ç›˜ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ¥åˆ›å»ºå‰ä¸¤ä¸ªã€‚

### 1.1 æ™ºèƒ½å½•å…¥æ¨¡æ¿ (æ¶ˆè´¹è®°å½•.md)

åœ¨ä½ çš„ Templater æ¨¡æ¿æ–‡ä»¶å¤¹ä¸­ï¼ˆä¾‹å¦‚ "Templates"ï¼‰ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `æ¶ˆè´¹è®°å½•.md` çš„æ–‡ä»¶ï¼Œå¹¶ç²˜è´´ä»¥ä¸‹**å®Œæ•´ä»£ç **ã€‚è¿™æ˜¯æ•´ä¸ªç³»ç»Ÿçš„â€œå†™å…¥å¤§è„‘â€ã€‚

<details>
<summary style="color: #4CAF50; font-weight: bold; cursor: pointer;">âš™ï¸ ç‚¹å‡»æŸ¥çœ‹/æŠ˜å â€œæ™ºèƒ½æ¶ˆè´¹å½•å…¥è„šæœ¬â€ä»£ç </summary>

```javascript
<%*
// --- æ™ºèƒ½æ¶ˆè´¹å½•å…¥è„šæœ¬ (V3.4 - æ”¯æŒå¹´/æœˆæ ‡é¢˜è‡ªåŠ¨åˆ›å»º) ---
// --- âš™ï¸ é…ç½®åŒº ---
const filePath = "è®°å½•/æ¶ˆè´¹/æ¶ˆè´¹-log.md"; // âš ï¸ã€æå…¶é‡è¦ã€‘è¯·ä¿®æ”¹ä¸ºä½ è‡ªå·±çš„æ¶ˆè´¹æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼
const dateFormat = "YY-MM-DD";
const categories = [" #é¤é¥® ", " #äº¤é€š ", " #è´­ç‰© ", " #å¨±ä¹ ", " #å­¦ä¹  ", " #ç”Ÿæ´»æ‚è´¹ ", " #åŒ»ç–—å¥åº· "];
// --- ç»“æŸé…ç½® ---

// --- Helper Function: å®‰å…¨è®¡ç®—å™¨ ---
function safeCalculate(expression) {
    try {
        const sanitized = expression.trim();
        if (!/^[0-9\.\+\-\s]+$/.test(sanitized)) return NaN;
        const result = new Function('return ' + sanitized)();
        return result;
    } catch (error) {
        return NaN;
    }
}

// --- 1. æ¨¡å¼é€‰æ‹©ä¸æ•°æ®è¾“å…¥ ---
let targetDateString;
let amountInput;
const initialInput = await tp.system.prompt("è¯·è¾“å…¥æ¶ˆè´¹é‡‘é¢ (æ”¯æŒåŠ å‡, æˆ–è¾“å…¥ '@' è¡¥å½•)", "", true);
if (!initialInput) return;

if (initialInput.trim() === '@') {
    const recentDays = [
        { text: `ä»Šå¤© (${tp.date.now(dateFormat)})`, value: tp.date.now(dateFormat) },
        { text: `æ˜¨å¤© (${tp.date.now(dateFormat, -1)})`, value: tp.date.now(dateFormat, -1) },
    ];
    for (let i = 2; i <= 7; i++) {
        recentDays.push({ text: `${i} å¤©å‰ (${tp.date.now(dateFormat, -i)})`, value: tp.date.now(dateFormat, -i) });
    }
    recentDays.push({ text: "æ‰‹åŠ¨æŒ‡å®šæ—¥æœŸ...", value: "manual" });

    const selectedDateOption = await tp.system.suggester(recentDays.map(d => d.text), recentDays.map(d => d.value), false, "è¯·é€‰æ‹©æ¶ˆè´¹æ—¥æœŸ");
    if (!selectedDateOption) return;

    if (selectedDateOption === 'manual') {
        const manualDate = await tp.system.prompt(`è¯·è¾“å…¥æ—¥æœŸ (æ ¼å¼: ${dateFormat})`, tp.date.now(dateFormat));
        if (!manualDate || !/^\d{2}-\d{2}-\d{2}$/.test(manualDate.trim())) {
            new Notice("âŒ æ—¥æœŸæ— æ•ˆæˆ–æ ¼å¼é”™è¯¯", 4000);
            return;
        }
        targetDateString = manualDate.trim();
    } else {
        targetDateString = selectedDateOption;
    }
    
    amountInput = await tp.system.prompt("è¯·è¾“å…¥æ¶ˆè´¹é‡‘é¢ (æ”¯æŒåŠ å‡)", "", true);
    if (!amountInput) return;

} else {
    targetDateString = tp.date.now(dateFormat);
    amountInput = initialInput;
}

// --- 2. é€šç”¨æ•°æ®å¤„ç† ---
const newAmount = safeCalculate(amountInput); 

if (isNaN(newAmount) || newAmount <= 0) {
    new Notice("âŒ é‡‘é¢æ— æ•ˆã€‚è¯·è¾“å…¥æ­£æ•°æˆ–ç®€å•çš„åŠ å‡æ³• (å¦‚ 30+10)ã€‚", 4000);
    return;
}
const categoryInput = (await tp.system.suggester(categories, categories, false, "è¯·é€‰æ‹©æ¶ˆè´¹ç±»åˆ«"))?.replace('#', '').trim();
if (!categoryInput) return;

const remarkInput = (await tp.system.prompt("è¯·è¾“å…¥å…·ä½“å¤‡æ³¨ (å¯é€‰)", "", false))?.trim() || "";

// --- 3. æ ¸å¿ƒæ–‡ä»¶å¤„ç†æ¨¡å— (V3.4 æ™ºèƒ½åˆ†åŒºä¸å¹´/æœˆæ ‡é¢˜) ---
const file = tp.file.find_tfile(filePath);
if (!file) {
    new Notice(`âŒ é”™è¯¯ï¼šæ‰¾ä¸åˆ°æ–‡ä»¶ "${filePath}"`, 5000);
    return;
}

const yearPart = targetDateString.substring(0, 2);
const yearHeader = `## 20${yearPart}`;
const monthHeader = `### ${targetDateString.substring(0, 5)}`;

const content = await app.vault.read(file);
const yearHeaderExists = content.includes(yearHeader);
const monthHeaderExists = content.includes(monthHeader);

const originalLines = content.split('\n');
const lineRegex = /^- \[(\d{2}-\d{2}-\d{2})\]-\[(\d+(?:\.\d+)?)\]-\[(.*)\]$/;

const nonTransactionLines = [];
let transactionLines = []; 

for (const line of originalLines) {
    if (line.match(lineRegex) || line.startsWith('### ') || line.startsWith('## ')) {
        transactionLines.push(line);
    } else {
        nonTransactionLines.push(line);
    }
}

let recordUpdated = false;
const newRemarkSegment = remarkInput 
    ? `${categoryInput}:${remarkInput}@${newAmount.toFixed(2)}` 
    : `${categoryInput}@${newAmount.toFixed(2)}`;

for (let i = 0; i < transactionLines.length; i++) {
    const match = transactionLines[i].match(lineRegex);
    if (match && match === targetDateString) {
        const currentAmount = parseFloat(match);
        const totalAmount = currentAmount + newAmount;
        const currentRemark = match.trim();
        const updatedRemark = currentRemark ? `${currentRemark}â†’${newRemarkSegment}` : newRemarkSegment;
        
        transactionLines[i] = `- [${targetDateString}]-[${totalAmount.toFixed(2)}]-[${updatedRemark}]`;
        recordUpdated = true;
        new Notice(`âœ… [${targetDateString}] æ¶ˆè´¹å·²åˆå¹¶ï¼`, 4000);
        break;
    }
}

if (!recordUpdated) {
    const newEntry = `- [${targetDateString}]-[${newAmount.toFixed(2)}]-[${newRemarkSegment}]`;
    
    if (!yearHeaderExists) {
        transactionLines.push(yearHeader);
        new Notice(`ğŸ‰ å·²ä¸ºæ‚¨åˆ›å»ºæ–°çš„å¹´ä»½æ ‡é¢˜: ${yearHeader}`, 4000);
    }
    
    if (!monthHeaderExists) {
        transactionLines.push(monthHeader);
        new Notice(`âœ’ï¸ å·²ä¸ºæ‚¨åˆ›å»ºæ–°çš„æœˆä»½æ ‡é¢˜: ${monthHeader}`, 4000);
    }
    
    transactionLines.push(newEntry);
    new Notice(`ğŸ“ å·²ä¸º [${targetDateString}] è®°å½•ç¬¬ä¸€ç¬”æ¶ˆè´¹`, 4000);
}

transactionLines.sort((a, b) => {
    const isAYearHeader = a.startsWith('## ');
    const isAMonthHeader = a.startsWith('### ');
    const isBYearHeader = b.startsWith('## ');
    const isBMonthHeader = b.startsWith('### ');

    let keyA, keyB;

    if (isAYearHeader) keyA = a.substring(5, 7);
    else if (isAMonthHeader) keyA = a.substring(4);
    else keyA = a.match(lineRegex)?. || '';
    
    if (isBYearHeader) keyB = b.substring(5, 7);
    else if (isBMonthHeader) keyB = b.substring(4);
    else keyB = b.match(lineRegex)?. || '';

    return keyA.localeCompare(keyB);
});

// --- 4. æ–‡ä»¶å†™å…¥ ---
const finalLines = [...nonTransactionLines.filter(line => line.trim() !== ''), ...transactionLines];
const finalContent = finalLines.join('\n').replace(/\n{3,}/g, '\n\n');

await app.vault.modify(file, finalContent);
%>
```

</details>

### 1.2 æ¶ˆè´¹æ—¥å¿—æ–‡ä»¶ (æ¶ˆè´¹-log.md)

è¿™æ˜¯ä½ çš„â€œæ•°æ®åº“â€ã€‚åœ¨ä½ å¸Œæœ›å­˜æ”¾æ—¥å¿—çš„ä½ç½®ï¼ˆä¾‹å¦‚ `è®°å½•/æ¶ˆè´¹/` æ–‡ä»¶å¤¹ä¸‹ï¼‰ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `æ¶ˆè´¹-log.md` çš„æ–‡ä»¶ã€‚

**åœ¨æ–‡ä»¶æœ€é¡¶éƒ¨**ï¼Œä½ å¯ä»¥ç²˜è´´ä»¥ä¸‹ä»£ç å—ï¼Œå®ƒèƒ½ä¸ºä½ å¿«é€Ÿè®¡ç®—æ—¥å¿—ä¸­çš„æ€»æ¶ˆè´¹é¢ã€‚

````markdown
```dataviewjs
// æ­¤è„šæœ¬ç”¨äºå¿«é€Ÿè®¡ç®—æœ¬æ–‡ä»¶å†…çš„æ€»æ¶ˆè´¹
const fileContent = await dv.io.load(dv.current().file.path);
const lines = fileContent.split('\n');
const regex = /-\s*\[.*?\]-\[(\d+\.?\d*)\]-.*/;
let totalAmount = 0;
for (const line of lines) {
    const match = line.match(regex);
    if (match && match) {
        const amountString = match;
        totalAmount += parseFloat(amountString);
    }
}
dv.paragraph(`ğŸ’° **å½“å‰æ—¥å¿—æ€»æ¶ˆè´¹ï¼šÂ¥${totalAmount.toFixed(2)}**`);
```

> [!IMPORTANT] å…³é”®ä¸€è‡´æ€§åŸåˆ™
> è¯·ç¡®ä¿**æ™ºèƒ½å½•å…¥è„šæœ¬**å’Œ**è´¢åŠ¡ä»ªè¡¨ç›˜**ï¼ˆè§Part 3ï¼‰é¡¶éƒ¨çš„ `filePath` è·¯å¾„ï¼Œä¸ä½ è¿™ä¸ªæ—¥å¿—æ–‡ä»¶çš„**çœŸå®è·¯å¾„å’Œæ–‡ä»¶å**å®Œå…¨ä¸€è‡´ï¼è¿™æ˜¯æ•´ä¸ªç³»ç»Ÿèƒ½ååŒå·¥ä½œçš„åŸºçŸ³ã€‚

---

## Part 2: é…ç½®â€œä¸€é”®å½•å…¥â€å‘½ä»¤

è®©é­”æ³•å‘ç”Ÿå¾—æ›´ç®€å•ã€‚

1.  **è®¾ç½® Templater æ¨¡æ¿æ–‡ä»¶å¤¹**ï¼š
    *   æ‰“å¼€ Obsidian è®¾ç½® > ç¤¾åŒºæ’ä»¶ > Templaterã€‚
    *   åœ¨â€œTemplate folder locationâ€ä¸­æŒ‡å®šä½ çš„æ¨¡æ¿æ–‡ä»¶å¤¹è·¯å¾„ï¼ˆå¦‚ `Templates`ï¼‰ã€‚

2.  **ç»‘å®šå¿«æ·é”®**ï¼š
    *   åœ¨ Templater è®¾ç½®ä¸­ï¼Œæ‰¾åˆ°â€œTemplate Hotkeysâ€éƒ¨åˆ†ã€‚
    *   ç‚¹å‡»â€œAdd new for templateâ€ï¼Œé€‰æ‹©æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ `æ¶ˆè´¹è®°å½•.md` æ¨¡æ¿ã€‚
    *   **ä¸ºå®ƒåˆ†é…ä¸€ä¸ªä½ é¡ºæ‰‹çš„å¿«æ·é”®**ï¼ˆä¾‹å¦‚ `âŒ¥+C`ï¼ŒC for Costï¼‰ï¼Œå®ç°çœŸæ­£çš„ä¸€é”®è§¦å‘ã€‚

ç°åœ¨ï¼Œè¯•è¯•æŒ‰ä¸‹ä½ çš„å¿«æ·é”®ï¼Œä½“éªŒä¸æ»‘çš„å½•å…¥æµç¨‹å§ï¼

## Part 3: æ‰“é€ ä½ çš„ä¸“å±â€œè´¢åŠ¡ä»ªè¡¨ç›˜â€

æœ€åä¸€æ­¥ï¼Œè®©æ²‰ç¡çš„æ•°æ®â€œå¼€å£è¯´è¯â€ã€‚åœ¨ä½ å¸Œæœ›å±•ç¤ºä»ªè¡¨ç›˜çš„ä»»ä½•åœ°æ–¹ï¼ˆä¾‹å¦‚ä½ çš„ä¸»é¡µ `Homepage.md`ï¼‰ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç¬”è®°ï¼ˆä¾‹å¦‚ `æ¶ˆè´¹ä»ªè¡¨ç›˜.md`ï¼‰ï¼Œå¹¶ç²˜è´´ä»¥ä¸‹**å®Œæ•´ä»£ç **ã€‚

<details>
<summary style="color: #FF6384; font-weight: bold; cursor: pointer;">ğŸ“Š ç‚¹å‡»æŸ¥çœ‹/æŠ˜å â€œè´¢åŠ¡ä»ªè¡¨ç›˜â€ä»£ç </summary>

````markdown
```dataviewjs
// --- æ¶ˆè´¹ä»ªè¡¨ç›˜ (V4.0) ---
// --- âš™ï¸ é…ç½®åŒº ---
const FILE_PATH = "è®°å½•/æ¶ˆè´¹/æ¶ˆè´¹-log.md";
const budgets = { "é¤é¥®": 1500, "è´­ç‰©": 1000, "å¨±ä¹": 500, "äº¤é€š": 800 };
// --- ç»“æŸé…ç½® ---
// å…¨å±€çŠ¶æ€ç®¡ç†
let state = {
    monthOffset: 0,
    yearOffset: 0
};
// å…¨å±€æ•°æ®ç¼“å­˜
let allTransactions = null;
/**
 * ä¸»æ¸²æŸ“å‡½æ•°
 */
async function renderDashboard(container) {
    container.innerHTML = '';
    if (allTransactions === null) {
        allTransactions = await parseTransactionData();
        if (allTransactions === null) {
            container.createEl("p", { text: "âŒ **é”™è¯¯ï¼š** æ— æ³•åŠ è½½æˆ–è§£ææ¶ˆè´¹æ—¥å¿—æ–‡ä»¶ã€‚" });
            return;
        }
    }
    renderMonthlyView(container, allTransactions, state.monthOffset);
    container.createEl('hr');
    renderAnnualView(container, allTransactions, state.yearOffset);
}
/**
 * æ¸²æŸ“æœˆåº¦è§†å›¾
 */
function renderMonthlyView(container, data, offset) {
    const view = container.createEl('div', { cls: 'monthly-view' });
    const targetMonth = dv.luxon.DateTime.now().plus({ months: offset });
    const nav = view.createEl('div', { attr: { style: 'display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 20px;' }});
   
    // --- æŒ‰é’® ---
    const prevButton = nav.createEl('button', { text: '<< ä¸Šä¸ªæœˆ' });
    prevButton.onclick = () => { state.monthOffset--; renderDashboard(container); };
   
    nav.createEl('h3', { text: targetMonth.toFormat("yyyyå¹´MMæœˆ"), attr: { style: 'margin: 0;' }});
   
    const nextButton = nav.createEl('button', { text: 'ä¸‹ä¸ªæœˆ >>' });
    nextButton.disabled = offset >= 0;
    nextButton.onclick = () => { state.monthOffset++; renderDashboard(container); };
   
    const homeButton = nav.createEl('button', { text: 'å›åˆ°æœ¬æœˆ' });
    homeButton.disabled = offset === 0;
    homeButton.onclick = () => { state.monthOffset = 0; renderDashboard(container); };
   
    // --- æœˆåº¦æ•°æ®èšåˆä¸æ¸²æŸ“ ---
    const transactions = data.filter(t => t.date.hasSame(targetMonth, 'month'));
    if (transactions.length === 0) {
        view.createEl("p", { text: `âœ… åœ¨ **${targetMonth.toFormat("yyyyå¹´MMæœˆ")}** æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æ¶ˆè´¹è®°å½•ã€‚` });
        return;
    }
   
    const total = transactions.reduce((sum, t) => sum + t.amount, 0);
    const categoryTotals = {};
    transactions.forEach(t => {
        categoryTotals[t.category] = (categoryTotals[t.category] || 0) + t.amount;
    });
    view.createEl('h2', { text: "æœˆåº¦æ¶ˆè´¹æ¦‚è§ˆ" });
    if (offset === 0) {
        let warnings = [];
        for (const cat in budgets) {
            const spent = categoryTotals[cat] || 0;
            if (spent > budgets[cat]) warnings.push(`- **${cat}** å·²è¶…æ”¯ <span style="color:red;">Â¥${(spent - budgets[cat]).toFixed(2)}</span>`);
        }
        if (warnings.length > 0) dv.markdown(view, `> [!WARNING] é¢„ç®—è¶…æ”¯æé†’\n> ${warnings.join('\n> ')}`);
    }
    let summary = `æœ¬æœˆæ€»æ”¯å‡º: **Â¥${total.toFixed(2)}**`;
    if (offset === 0) {
        const weekTotal = transactions.filter(t => t.date.hasSame(dv.luxon.DateTime.now(), 'week')).reduce((s, t) => s + t.amount, 0);
        summary += ` | æœ¬å‘¨æ€»æ”¯å‡º: **Â¥${weekTotal.toFixed(2)}**`;
    }
    dv.paragraph(summary);
    const chartContainer = view.createEl('div', { attr: { style: 'width: 300px; max-height: 300px; margin: 20px auto; text-align: center;' } });
    renderPieChart(chartContainer, categoryTotals, `${targetMonth.toFormat("yyyyå¹´MMæœˆ")}æ¶ˆè´¹åˆ†ç±»`);
   
    view.createEl('h4', { text: "è¯¦ç»†åˆ†ç±»ç»Ÿè®¡" });
    dv.table(["æ¶ˆè´¹ç±»åˆ«", "æ€»é‡‘é¢ (Â¥)", "å æ¯”"], Object.entries(categoryTotals).sort((a, b) => b[1] - a[1]).map(([cat, amount]) => [cat, `Â¥${amount.toFixed(2)}`, `${((amount / total) * 100).toFixed(1)}%`]));
}
/**
 * æ¸²æŸ“å¹´åº¦è§†å›¾
 */
function renderAnnualView(container, data, offset) {
    const view = container.createEl('div', { cls: 'annual-view' });
    const targetYear = dv.luxon.DateTime.now().plus({ years: offset });
    const nav = view.createEl('div', { attr: { style: 'display: flex; align-items: center; justify-content: center; gap: 15px; margin-top: 20px; margin-bottom: 20px;' }});
   
    const prevButton = nav.createEl('button', { text: '<< ä¸Šä¸€å¹´' });
    prevButton.onclick = () => { state.yearOffset--; renderDashboard(container); };
   
    nav.createEl('h3', { text: `${targetYear.toFormat("yyyy")}å¹´å›é¡¾`, attr: { style: 'margin: 0;' }});
   
    const nextButton = nav.createEl('button', { text: 'ä¸‹ä¸€å¹´ >>' });
    nextButton.disabled = offset >= 0;
    nextButton.onclick = () => { state.yearOffset++; renderDashboard(container); };
   
    const homeButton = nav.createEl('button', { text: 'å›åˆ°ä»Šå¹´' });
    homeButton.disabled = offset === 0;
    homeButton.onclick = () => { state.yearOffset = 0; renderDashboard(container); };
   
    const transactions = data.filter(t => t.date.hasSame(targetYear, 'year'));
    if (transactions.length === 0) {
        view.createEl("p", { text: `âœ… åœ¨ **${targetYear.toFormat("yyyy")}å¹´** æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æ¶ˆè´¹è®°å½•ã€‚` });
        return;
    }
    const monthlyTotals = Array(12).fill(0);
    const categoryTotals = {};
    transactions.forEach(t => {
        monthlyTotals[t.date.month - 1] += t.amount;
        categoryTotals[t.category] = (categoryTotals[t.category] || 0) + t.amount;
    });
    const total = monthlyTotals.reduce((sum, m) => sum + m, 0);
    const activeMonths = targetYear.year === dv.luxon.DateTime.now().year ? dv.luxon.DateTime.now().month : 12;
    const avg = total / activeMonths;
    const maxMonthValue = Math.max(...monthlyTotals);
    const maxMonthIndex = monthlyTotals.indexOf(maxMonthValue);
    const topCategory = Object.entries(categoryTotals).sort((a, b) => b[1] - a[1])[0];
    view.createEl('h2', { text: "å¹´åº¦è´¢åŠ¡æ‘˜è¦" });
    const summaryEl = view.createEl('div', { attr: { style: 'display: flex; justify-content: space-around; text-align: center; margin-bottom: 20px;' }});
    summaryEl.createEl('div').innerHTML = `<strong>å¹´åº¦æ€»æ”¯å‡º</strong><br>Â¥${total.toFixed(2)}`;
    summaryEl.createEl('div').innerHTML = `<strong>æœˆå‡æ¶ˆè´¹</strong><br>Â¥${avg.toFixed(2)}`;
    summaryEl.createEl('div').innerHTML = `<strong>æ¶ˆè´¹æœ€é«˜æœˆä»½</strong><br>${maxMonthIndex + 1}æœˆ (Â¥${maxMonthValue.toFixed(2)})`;
    summaryEl.createEl('div').innerHTML = `<strong>æ”¯å‡ºå† å†›ç±»åˆ«</strong><br>${topCategory[0]} (Â¥${topCategory[1].toFixed(2)})`;
   
    const chartContainer = view.createEl('div');
    renderLineChart(chartContainer, monthlyTotals, `${targetYear.year}å¹´æœˆåº¦æ¶ˆè´¹è¶‹åŠ¿`);
}
/**
 * æ•°æ®è§£æå‡½æ•°
 */
async function parseTransactionData() {
    const file = app.vault.getAbstractFileByPath(FILE_PATH);
    if (!file) return null;
    const content = await app.vault.read(file);
    const lines = content.trim().split('\n').filter(line => line.trim());
    if (lines.length === 0) return [];
    const transactions = [];
    const regex = /^-\s*\[(\d{2}-\d{2}-\d{2})\]-\[(\d+\.?\d*)\]-\[(.*?)\]$/;
    for (const line of lines) {
        const match = line.match(regex);
        if (!match) continue;
        const date = dv.luxon.DateTime.fromFormat(match[1], "yy-MM-dd", { zone: 'local' });
        if (!date.isValid) continue;
        const totalAmount = parseFloat(match[2]);
        if (isNaN(totalAmount) || totalAmount <= 0) continue;
        const remarksStr = match[3].trim();
        const remarks = remarksStr.split('â†’').map(r => r.trim()).filter(r => r);
        if (remarks.length === 0) continue;
       
        const averageAmount = totalAmount / remarks.length;
        let hasSubAmounts = false, subSum = 0;
        const tempSubs = [];
        for (const r of remarks) {
            const parts = r.split('@');
            if (parts.length > 1) {
                const sub = parseFloat(parts.pop().trim());
                if (!isNaN(sub)) { tempSubs.push(sub); subSum += sub; hasSubAmounts = true; }
                else { tempSubs.push(null); }
            } else { tempSubs.push(null); }
        }
       
        const useSubAmounts = hasSubAmounts && tempSubs.every(s => s !== null) && Math.abs(subSum - totalAmount) < 0.01;
       
        for (let i = 0; i < remarks.length; i++) {
            const r = remarks[i];
            const parts = r.split('@');
            const catNote = parts.length > 1 ? parts.slice(0, -1).join('@') : r;
            const itemAmount = useSubAmounts ? tempSubs[i] : averageAmount;
            const [category, ...noteParts] = catNote.split(':').map(p => p.trim());
            transactions.push({
                date,
                amount: itemAmount,
                category: category.replace(/[`#]/g, '') || 'æœªåˆ†ç±»',
                note: noteParts.join(':').trim()
            });
        }
    }
    return transactions;
}
/**
 * å›¾è¡¨æ¸²æŸ“å‡½æ•°ï¼ˆä»…ä¿®å¤é¥¼å›¾ï¼‰
 */
function renderPieChart(container, data, title) {
    const chartData = {
        type: 'pie',
        data: {
            labels: Object.keys(data),
            datasets: [{
                data: Object.values(data).map(v => parseFloat(v.toFixed(2))),
                backgroundColor: ["#FF6384", "#36A2EB", "#FFCE56", "#4BC0C0", "#9966FF", "#FF9F40"]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                title: { display: true, text: title }
            }
        }
    };
    if (typeof Chart !== 'undefined') {
        try {
            window.renderChart(chartData, container);
            console.log(`é¥¼å›¾æ¸²æŸ“æˆåŠŸ: ${title}`);
        } catch (e) {
            container.createEl('p', { text: `âŒ é¥¼å›¾æ¸²æŸ“å¤±è´¥: ${e.message}` });
            console.error('é¥¼å›¾æ¸²æŸ“é”™è¯¯:', e);
        }
    } else {
        container.createEl('p', { text: 'ğŸ“ˆ Chart.js æœªåŠ è½½ï¼Œé¥¼å›¾æ— æ³•æ˜¾ç¤ºã€‚' });
    }
}
function renderLineChart(container, data, title) {
    const chartData = { type: 'line', data: { labels: ['1æœˆ','2æœˆ','3æœˆ','4æœˆ','5æœˆ','6æœˆ','7æœˆ','8æœˆ','9æœˆ','10æœˆ','11æœˆ','12æœˆ'], datasets: [{ label: 'æœˆåº¦æ¶ˆè´¹', data: data.map(v => v.toFixed(2)), fill: false, borderColor: 'rgb(75, 192, 192)', tension: 0.1 }] }, options: { plugins: { title: { display: true, text: title } } } };
    if (typeof Chart !== 'undefined') window.renderChart(chartData, container);
}
/**
 * å¯åŠ¨é€»è¾‘
 */
function initialize() {
    if (typeof Chart === 'undefined') {
        dv.paragraph("âš ï¸ Chart.js æœªåŠ è½½ï¼Œå°è¯•åŠ¨æ€åŠ è½½...");
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/chart.js';
        document.head.appendChild(script);
        script.onload = () => {
            console.log('Chart.js åŠ è½½æˆåŠŸ');
            renderDashboard(this.container);
        };
        script.onerror = () => {
            dv.paragraph("âŒ æ— æ³•åŠ è½½ Chart.js åº“ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ã€‚");
            renderDashboard(this.container); // ç»§ç»­æ¸²æŸ“ï¼ˆæ— å›¾è¡¨ï¼‰
        };
    } else {
        console.log('Chart.js å·²åŠ è½½');
        renderDashboard(this.container);
    }
}
if (typeof dv.luxon === 'undefined') {
    dv.paragraph("âŒ **é”™è¯¯ï¼š** Luxon æœªåŠ è½½ï¼ŒDataview ç¯å¢ƒå¼‚å¸¸ã€‚");
} else {
    initialize.call(this);
}
```
</details>

> æç¤ºï¼šä»ªè¡¨ç›˜ä»£ç ä¼šè‡ªåŠ¨ä»ç½‘ç»œåŠ è½½ Chart.js åº“æ¥ç»˜åˆ¶å›¾è¡¨ã€‚å¦‚æœå›¾è¡¨ä¸æ˜¾ç¤ºï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œ Obsidian çš„ç½‘ç»œæƒé™ã€‚

## ç»“è¯­

æ­å–œä½ ï¼ä½ å·²ç»æ‹¥æœ‰äº†ä¸€å¥—å¼ºå¤§ã€ç§å¯†ä¸”å®Œå…¨ç”±ä½ æŒæ§çš„ä¸ªäººæ¶ˆè´¹è‡ªåŠ¨åŒ–ç³»ç»Ÿã€‚ä»ç°åœ¨å¼€å§‹ï¼Œå‘Šåˆ«ç¹çï¼Œæ‹¥æŠ±é«˜æ•ˆã€‚è¿™å¥—ç³»ç»Ÿä¸ä»…æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œæ›´æ˜¯ä½ å®è·µä¸ªäººç†è´¢ã€ä¼˜åŒ–ç”Ÿæ´»æ–¹å¼çš„å¾—åŠ›åŠ©æ‰‹ã€‚

æˆ‘å°†è‡ªå·±æ‘¸ç´¢å’Œè°ƒè¯•çš„ç»éªŒæµ“ç¼©åœ¨è¿™ç¯‡æ•™ç¨‹é‡Œï¼Œå¸Œæœ›èƒ½è®©ä½ å°‘èµ°å¼¯è·¯ï¼Œç›´æ¥äº«å—æˆæœã€‚å¦‚æœåœ¨é…ç½®æˆ–ä½¿ç”¨ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€äº¤æµã€‚

å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¸å¦¨åˆ†äº«ç»™åŒæ ·çƒ­çˆ± Obsidian å’Œæ•ˆç‡ç”Ÿæ´»çš„æœ‹å‹ä»¬ã€‚

âœ¨â€‹**æ¸©é¦¨æç¤º**â€‹âœ¨

> ä»¥ä¸Šæ‰€æœ‰ä»£ç å‡ä¸ºçº¯ç²¹çš„æœ¬åœ°åŒ–è„šæœ¬ï¼Œæ‰€æœ‰çš„æ•°æ®è¯»å–ã€å¤„ç†å’Œè®¡ç®—éƒ½åœ¨ä½ è‡ªå·±çš„è®¾å¤‡ä¸Šå®Œæˆã€‚
> â€‹æœ€å…³é”®çš„ä¸€ç‚¹ï¼š**å®ƒä¸ä¼šå°†ä½ çš„ä»»ä½•æ•°æ®ä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨ï¼â€‹**â€‹ä½ çš„è´¢åŠ¡æ•°æ®ï¼Œæ°¸è¿œåªå±äºä½ ã€‚

å¦‚æœä½ é‡åˆ°äº†ç¨‹åºé”™è¯¯ï¼Œæˆ–è€…çµå…‰ä¸€ç°æœ‰äº†è¶…æ£’çš„æƒ³æ³•ï¼Œéšæ—¶æ¬¢è¿å‘Šè¯‰æˆ‘ï¼

ğŸ“§ é‚®ä»¶ï¼š[Socrates.02zx@Gmail.com](mailto:Socrates.02zx@Gmail.com)

æ„Ÿè°¢é˜…è¯»ï¼Œç¥ä½ è®°è´¦æ„‰å¿«ï¼:)